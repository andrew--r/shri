{"version":3,"sources":["webpack:///bundle.js","webpack:///webpack/bootstrap eef8a904ddc3ea516920","webpack:///./source/js/index.js","webpack:///./source/js/helpers.js","webpack:///./source/js/modules/application.js","webpack:///./source/js/modules/player.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","onDOMContentLoaded","window","application","_application2","_application","document","addEventListener","formatSeconds","seconds","minutesCount","Math","floor","formatXXNumber","round","number","result","toString","formattedTimeToSeconds","timeString","data","split","hours","parseInt","minutes","parseFloat","replace","getRandomInt","min","max","random","getRandom","Object","defineProperty","value","_classCallCheck","instance","Constructor","TypeError","_player","_player2","Application","onFormSubmit","event","_this","this","preventDefault","keys","links","forEach","type","form","querySelector","pages","start","classList","remove","visiblePageClass","main","add","player","root","resources","options","arguments","length","undefined","baseClass","video","subtitles","soundtrack","bind","drawRandomArtifact","context","width","height","center","x","_helpers","y","coefficient","firstPoint","secondPoint","baseColor","strokeStyle","lineWidth","beginPath","moveTo","quadraticCurveTo","stroke","_createClass","defineProperties","target","props","i","descriptor","enumerable","configurable","writable","key","protoProps","staticProps","prototype","Player","_ref","onPlayToggle","isPlaying","classes","base","stage","canvas","visible","playButton","paused","playing","time","watched","total","fakeVideo","progress","bar","elements","timeWatched","timeTotal","progressBar","state","videoIsPlaying","audioIsPlaying","canvasContext","getContext","Promise","all","_loadVideo","_loadSoundtrack","_loadSubtitles","then","_setupCanvas","_parseSubtitles","_setupTiming","_setupSound","_addEventListeners","play","_onPlayToggle","counter","_elements","canvasSize","_computeCanvasSize","virtualCanvas","createElement","virtualCanvasContext","_drawFrame","map","slide","timing","end","duration","text","slice","join","subtitlesDuration","reduce","slideData","videoDuration","watchedSeconds","prevWatchedSecond","lastFrameTimestamp","passedSubtitlesTime","subtitlesSequenceTime","timeline","index","array","nextSlide","prevSlide","isSynthethic","prevEnd","currentStart","currentEnd","push","_updateTotalTime","audioContext","AudioContext","webkitAudioContext","audioSource","createMediaElementSource","audio","bufferSize","brownNoise","lastOut","node","createScriptProcessor","onaudioprocess","e","output","outputBuffer","getChannelData","white","connect","destination","distortion","createWaveShaper","biquadFilter","createBiquadFilter","frequency","gain","url","_this2","resolve","reject","defaultMuted","appendChild","src","_this3","loop","fetch","response","resume","pause","suspend","innerText","_timing","prevWatchedSeconds","style","transform","currentFrameTimestamp","Date","_updateWatchedTime","_canvasSize","findFrameData","_ref2","currentFrameData","find","_playVideo","textWasDrawn","drawImage","_pauseVideo","_drawSubtitles","_applyEffects","_canvasSize2","fillStyle","fillRect","heightStart","widthStart","lineHeight","font","row","fillText","_canvasSize3","grayscalePixelData","_applyGrayscale","getImageData","putImageData","pixelData","pixels","pixelsLength","brightnessCoefficient","r","g","b","average","_this4","requestAnimationFrame","_updateTiming","_updateCanvas","videoSize","videoWidth","videoHeight","clientWidth","clientHeight","parentNode","removeChild","_playSoundtrack","_pauseSoundtrack"],"mappings":"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","file":"bundle.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _application = __webpack_require__(2);\n\t\n\tvar _application2 = _interopRequireDefault(_application);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tdocument.addEventListener('DOMContentLoaded', onDOMContentLoaded);\n\t\n\tfunction onDOMContentLoaded() {\n\t\twindow.application = new _application2.default();\n\t}\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\texports.formatSeconds = formatSeconds;\n\texports.formattedTimeToSeconds = formattedTimeToSeconds;\n\texports.getRandomInt = getRandomInt;\n\texports.getRandom = getRandom;\n\tfunction formatSeconds(seconds) {\n\t\tvar minutesCount = Math.floor(seconds / 60);\n\t\n\t\treturn formatXXNumber(minutesCount) + ':' + formatXXNumber(Math.round(seconds % 60));\n\t}\n\t\n\tfunction formatXXNumber(number) {\n\t\tvar result = void 0;\n\t\n\t\tif (number < 10 && number >= 1) {\n\t\t\tresult = '0' + Math.round(number);\n\t\t} else if (number < 1) {\n\t\t\tresult = '00';\n\t\t} else {\n\t\t\tresult = number.toString();\n\t\t}\n\t\n\t\treturn result;\n\t}\n\t\n\tfunction formattedTimeToSeconds(timeString) {\n\t\tvar data = timeString.split(':');\n\t\tvar hours = parseInt(data[0], 10);\n\t\tvar minutes = parseInt(data[1], 10);\n\t\tvar seconds = Math.round(parseFloat(data[2].replace(',', '.'), 10));\n\t\n\t\treturn seconds + minutes * 60 + hours * 60 * 60;\n\t}\n\t\n\tfunction getRandomInt(min, max) {\n\t\treturn Math.floor(Math.random() * (max - min + 1)) + min;\n\t}\n\t\n\tfunction getRandom(min, max) {\n\t\treturn Math.random() * (max - min) + min;\n\t}\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\t\n\tvar _player = __webpack_require__(3);\n\t\n\tvar _player2 = _interopRequireDefault(_player);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar Application = function Application() {\n\t\tvar options = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n\t\n\t\t_classCallCheck(this, Application);\n\t\n\t\tvar baseClass = options.baseClass || 'app';\n\t\tvar visiblePageClass = baseClass + '__page_visible';\n\t\n\t\tthis.root = document.querySelector('.' + baseClass);\n\t\tthis.form = this.root.querySelector('.' + baseClass + '__form');\n\t\tthis.pages = {\n\t\t\tstart: this.root.querySelector('.' + baseClass + '__page_start'),\n\t\t\tmain: this.root.querySelector('.' + baseClass + '__page_main')\n\t\t};\n\t\n\t\tthis.links = {\n\t\t\tvideo: '',\n\t\t\tsubtitles: '',\n\t\t\tsoundtrack: ''\n\t\t};\n\t\n\t\tthis.form.addEventListener('submit', onFormSubmit.bind(this));\n\t\n\t\tfunction onFormSubmit(event) {\n\t\t\tvar _this = this;\n\t\n\t\t\tevent.preventDefault();\n\t\n\t\t\tObject.keys(this.links).forEach(function (type) {\n\t\t\t\t_this.links[type] = _this.form.querySelector('[data-link-type=\"' + type + '\"]').value;\n\t\t\t});\n\t\n\t\t\tthis.pages.start.classList.remove(visiblePageClass);\n\t\t\tthis.pages.main.classList.add(visiblePageClass);\n\t\n\t\t\twindow.player = this.player = new _player2.default({\n\t\t\t\troot: this.root.querySelector('.player'),\n\t\t\t\tresources: this.links\n\t\t\t});\n\t\t}\n\t};\n\t\n\texports.default = Application;\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _helpers = __webpack_require__(1);\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar DEFAULTS = {\n\t\tmaxCollisionLineLength: 150\n\t};\n\t\n\tvar Player = function () {\n\t\tfunction Player(_ref) {\n\t\t\tvar _this = this;\n\t\n\t\t\tvar root = _ref.root;\n\t\t\tvar resources = _ref.resources;\n\t\n\t\t\t_classCallCheck(this, Player);\n\t\n\t\t\tvar baseClass = 'player';\n\t\t\tvar classes = this.classes = {\n\t\t\t\tbase: baseClass,\n\t\t\t\tstage: {\n\t\t\t\t\tbase: baseClass + '__stage'\n\t\t\t\t},\n\t\t\t\tcanvas: {\n\t\t\t\t\tbase: baseClass + '__canvas'\n\t\t\t\t},\n\t\t\t\tsubtitles: {\n\t\t\t\t\tbase: baseClass + '__subtitles',\n\t\t\t\t\tvisible: baseClass + '__subtitles_visible'\n\t\t\t\t},\n\t\t\t\tplayButton: {\n\t\t\t\t\tbase: baseClass + '__control_state',\n\t\t\t\t\tpaused: baseClass + '__control_state_play',\n\t\t\t\t\tplaying: baseClass + '__control_state_pause'\n\t\t\t\t},\n\t\t\t\tvideo: {\n\t\t\t\t\tbase: baseClass + '__video'\n\t\t\t\t},\n\t\t\t\ttime: {\n\t\t\t\t\tbase: 'time',\n\t\t\t\t\twatched: 'time__watched',\n\t\t\t\t\ttotal: 'time__total'\n\t\t\t\t},\n\t\t\t\tfakeVideo: {\n\t\t\t\t\tbase: baseClass + '__fakeVideo'\n\t\t\t\t},\n\t\t\t\tprogress: {\n\t\t\t\t\tbase: 'progress',\n\t\t\t\t\tbar: 'progress__bar'\n\t\t\t\t}\n\t\t\t};\n\t\n\t\t\tvar elements = this.elements = {\n\t\t\t\troot: root,\n\t\t\t\tstage: root.querySelector('.' + classes.stage.base),\n\t\t\t\tcanvas: root.querySelector('.' + classes.canvas.base),\n\t\t\t\tsubtitles: root.querySelector('.' + classes.subtitles.base),\n\t\t\t\tplayButton: root.querySelector('.' + classes.playButton.base),\n\t\t\t\ttimeWatched: root.querySelector('.' + classes.time.watched),\n\t\t\t\ttimeTotal: root.querySelector('.' + classes.time.total),\n\t\t\t\tprogressBar: root.querySelector('.' + classes.progress.bar)\n\t\t\t};\n\t\n\t\t\tthis.state = {\n\t\t\t\tvideoIsPlaying: false,\n\t\t\t\taudioIsPlaying: false\n\t\t\t};\n\t\n\t\t\tthis.canvasContext = this.elements.canvas.getContext('2d');\n\t\n\t\t\tthis.isPlaying = false;\n\t\n\t\t\tPromise.all([this._loadVideo(resources.video), this._loadSoundtrack(resources.soundtrack), this._loadSubtitles(resources.subtitles)]).then(function (result) {\n\t\t\t\t_this.video = result[0];\n\t\t\t\t_this.soundtrack = result[1];\n\t\t\t\t_this.subtitles = result[2];\n\t\n\t\t\t\t_this._setupCanvas();\n\t\t\t\t_this._parseSubtitles();\n\t\t\t\t_this._setupTiming();\n\t\t\t\t_this._setupSound();\n\t\t\t\t_this._addEventListeners();\n\t\n\t\t\t\telements.root.classList.add(classes.base + '_initialized');\n\t\t\t\t_this.play();\n\t\t\t});\n\t\n\t\t\tthis._onPlayToggle = onPlayToggle.bind(this);\n\t\n\t\t\tfunction onPlayToggle(event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis[this.isPlaying ? 'pause' : 'play']();\n\t\t\t}\n\t\n\t\t\tthis.counter = 0;\n\t\n\t\t\t// debug only\n\t\t\twindow.player = this;\n\t\t}\n\t\n\t\t_createClass(Player, [{\n\t\t\tkey: '_setupCanvas',\n\t\t\tvalue: function _setupCanvas() {\n\t\t\t\tvar video = this.video;\n\t\t\t\tvar canvasContext = this.canvasContext;\n\t\t\t\tvar _elements = this.elements;\n\t\t\t\tvar canvas = _elements.canvas;\n\t\t\t\tvar stage = _elements.stage;\n\t\n\t\t\t\tvar canvasSize = this.canvasSize = this._computeCanvasSize();\n\t\t\t\tvar virtualCanvas = this.virtualCanvas = document.createElement('canvas');\n\t\t\t\tvar virtualCanvasContext = this.virtualCanvasContext = this.virtualCanvas.getContext('2d');\n\t\n\t\t\t\tcanvas.width = canvasSize.width;\n\t\t\t\tcanvas.height = canvasSize.height;\n\t\t\t\tvirtualCanvas.width = canvasSize.width;\n\t\t\t\tvirtualCanvas.height = canvasSize.height;\n\t\n\t\t\t\tthis._drawFrame();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_parseSubtitles',\n\t\t\tvalue: function _parseSubtitles() {\n\t\t\t\tthis.subtitles = this.subtitles.split('\\n\\n').map(function (slide) {\n\t\t\t\t\tvar data = slide.split('\\n');\n\t\t\t\t\tvar timing = data[1].split(' --> ');\n\t\t\t\t\tvar result = {\n\t\t\t\t\t\tid: null,\n\t\t\t\t\t\tstart: null,\n\t\t\t\t\t\tend: null,\n\t\t\t\t\t\tduration: null,\n\t\t\t\t\t\ttext: null\n\t\t\t\t\t};\n\t\n\t\t\t\t\tresult.id = parseInt(data[0], 10);\n\t\t\t\t\tresult.start = (0, _helpers.formattedTimeToSeconds)(timing[0]);\n\t\t\t\t\tresult.duration = (0, _helpers.formattedTimeToSeconds)(timing[1]) - result.start;\n\t\t\t\t\tresult.end = result.start + result.duration;\n\t\t\t\t\tresult.text = data.slice(2).join('\\n');\n\t\n\t\t\t\t\treturn result;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_setupTiming',\n\t\t\tvalue: function _setupTiming() {\n\t\t\t\tvar subtitlesDuration = this.subtitles.reduce(function (result, slideData) {\n\t\t\t\t\treturn result + slideData.duration;\n\t\t\t\t}, 0);\n\t\t\t\tvar videoDuration = Math.round(this.video.duration);\n\t\t\t\tvar duration = videoDuration + subtitlesDuration;\n\t\n\t\t\t\tthis.timing = {\n\t\t\t\t\tduration: duration,\n\t\t\t\t\twatchedSeconds: 0,\n\t\t\t\t\tprevWatchedSecond: 0,\n\t\t\t\t\tlastFrameTimestamp: null\n\t\t\t\t};\n\t\n\t\t\t\tvar passedSubtitlesTime = 0;\n\t\t\t\tvar subtitlesSequenceTime = 0;\n\t\n\t\t\t\tthis.timeline = this.subtitles.reduce(function (result, slide, index, array) {\n\t\t\t\t\tvar isLast = index === array.length - 1;\n\t\t\t\t\tvar nextSlide = array[index + 1];\n\t\t\t\t\tvar prevSlide = array[index - 1] || {\n\t\t\t\t\t\tstart: 0,\n\t\t\t\t\t\tend: 0,\n\t\t\t\t\t\tduration: 0,\n\t\t\t\t\t\tisSynthethic: true\n\t\t\t\t\t};\n\t\n\t\t\t\t\tvar prevEnd = prevSlide.end + passedSubtitlesTime;\n\t\t\t\t\tvar currentStart = slide.start + passedSubtitlesTime;\n\t\t\t\t\tvar currentEnd = slide.end + passedSubtitlesTime;\n\t\t\t\t\tvar nextStart = nextSlide && nextSlide.start + passedSubtitlesTime;\n\t\n\t\t\t\t\tif (prevSlide.end < slide.start) {\n\t\t\t\t\t\tresult.push({\n\t\t\t\t\t\t\tstart: prevEnd,\n\t\t\t\t\t\t\tend: currentStart,\n\t\t\t\t\t\t\ttype: 'video'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// result.push({\n\t\t\t\t\t// \tstart: currentStart,\n\t\t\t\t\t// \tend: currentEnd,\n\t\t\t\t\t// \ttype: 'subtitles',\n\t\t\t\t\t// \ttext: slide.text,\n\t\t\t\t\t// });\n\t\n\t\t\t\t\t// result.push({\n\t\t\t\t\t// \tstart: currentEnd,\n\t\t\t\t\t// \tend: currentEnd + slide.duration,\n\t\t\t\t\t// \ttype: 'video',\n\t\t\t\t\t// });\n\t\n\t\t\t\t\tresult.push({\n\t\t\t\t\t\tstart: currentStart,\n\t\t\t\t\t\tend: currentEnd,\n\t\t\t\t\t\ttype: 'video'\n\t\t\t\t\t});\n\t\n\t\t\t\t\tresult.push({\n\t\t\t\t\t\tstart: currentEnd,\n\t\t\t\t\t\tend: currentEnd + slide.duration,\n\t\t\t\t\t\ttype: 'subtitles',\n\t\t\t\t\t\ttext: slide.text\n\t\t\t\t\t});\n\t\n\t\t\t\t\tpassedSubtitlesTime += slide.duration + subtitlesSequenceTime;\n\t\n\t\t\t\t\tif (!nextSlide) {\n\t\t\t\t\t\tresult.push({\n\t\t\t\t\t\t\tstart: slide.end + passedSubtitlesTime,\n\t\t\t\t\t\t\tend: duration,\n\t\t\t\t\t\t\tduration: duration - slide.end + passedSubtitlesTime,\n\t\t\t\t\t\t\ttype: 'video'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\n\t\t\t\t\treturn result;\n\t\t\t\t}, []);\n\t\n\t\t\t\tthis._updateTotalTime();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_setupSound',\n\t\t\tvalue: function _setupSound() {\n\t\t\t\tvar audioContext = this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n\t\t\t\tvar audioSource = this.audioSource = audioContext.createMediaElementSource(this.elements.audio);\n\t\t\t\tvar bufferSize = 4096;\n\t\t\t\tvar brownNoise = function () {\n\t\t\t\t\tvar lastOut = 0.0;\n\t\t\t\t\tvar node = audioContext.createScriptProcessor(bufferSize, 1, 1);\n\t\t\t\t\tnode.onaudioprocess = function (e) {\n\t\t\t\t\t\tvar output = e.outputBuffer.getChannelData(0);\n\t\t\t\t\t\tfor (var i = 0; i < bufferSize; i++) {\n\t\t\t\t\t\t\tvar white = Math.random() * 2 - 1;\n\t\t\t\t\t\t\toutput[i] = (lastOut + 0.02 * white) / 1.02;\n\t\t\t\t\t\t\tlastOut = output[i];\n\t\t\t\t\t\t\toutput[i] *= 0.5; // (roughly) compensate for gain\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\treturn node;\n\t\t\t\t}();\n\t\n\t\t\t\tbrownNoise.connect(audioContext.destination);\n\t\n\t\t\t\tvar distortion = audioContext.createWaveShaper();\n\t\t\t\tvar biquadFilter = audioContext.createBiquadFilter();\n\t\t\t\tbiquadFilter.type = 'lowpass';\n\t\t\t\tbiquadFilter.frequency.value = 500;\n\t\t\t\tbiquadFilter.gain.value = 5;\n\t\n\t\t\t\taudioSource.connect(distortion);\n\t\t\t\tdistortion.connect(biquadFilter);\n\t\t\t\tbiquadFilter.connect(audioContext.destination);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_addEventListeners',\n\t\t\tvalue: function _addEventListeners() {\n\t\t\t\tvar elements = this.elements;\n\t\n\t\t\t\t// elements.playButton.addEventListener('click', this._onPlayToggle);\n\t\t\t\t// elements.stage.addEventListener('click', this._onPlayToggle);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_removeEventListeners',\n\t\t\tvalue: function _removeEventListeners() {\n\t\t\t\tvar elements = this.elements;\n\t\n\t\t\t\t// elements.playButton.removeEventListener('click', this._onPlayButtonClick);\n\t\t\t\t// elements.stage.removeEventListener('click', this._onPlayToggle);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_loadVideo',\n\t\t\tvalue: function _loadVideo(url) {\n\t\t\t\tvar _this2 = this;\n\t\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\tvar elements = _this2.elements;\n\t\n\t\t\t\t\tvar video = document.createElement('video');\n\t\t\t\t\tvideo.defaultMuted = true;\n\t\t\t\t\tvideo.classList.add(_this2.classes.video.base);\n\t\t\t\t\telements.stage.appendChild(video);\n\t\n\t\t\t\t\tvideo.addEventListener('error', reject);\n\t\t\t\t\tvideo.addEventListener('canplaythrough', function (event) {\n\t\t\t\t\t\tresolve(video);\n\t\t\t\t\t});\n\t\n\t\t\t\t\tvideo.src = url;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_loadSoundtrack',\n\t\t\tvalue: function _loadSoundtrack(url) {\n\t\t\t\tvar _this3 = this;\n\t\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\tvar elements = _this3.elements;\n\t\n\t\t\t\t\tvar audio = elements.audio = document.createElement('audio');\n\t\t\t\t\taudio.classList.add(_this3.classes.base + '__audio');\n\t\t\t\t\telements.stage.appendChild(audio);\n\t\n\t\t\t\t\taudio.addEventListener('error', reject);\n\t\t\t\t\taudio.addEventListener('canplaythrough', function (event) {\n\t\t\t\t\t\taudio.loop = true;\n\t\t\t\t\t\tresolve(audio);\n\t\t\t\t\t});\n\t\n\t\t\t\t\taudio.src = url;\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_loadSubtitles',\n\t\t\tvalue: function _loadSubtitles(url) {\n\t\t\t\treturn fetch(url).then(function (response) {\n\t\t\t\t\treturn response.text();\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_playSoundtrack',\n\t\t\tvalue: function _playSoundtrack() {\n\t\t\t\tif (!this.state.audioIsPlaying) {\n\t\t\t\t\tthis.soundtrack.play();\n\t\t\t\t\tthis.audioContext.resume();\n\t\t\t\t\tthis.state.audioIsPlaying = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_playVideo',\n\t\t\tvalue: function _playVideo() {\n\t\t\t\tif (!this.state.videoIsPlaying) {\n\t\t\t\t\tthis.video.play();\n\t\t\t\t\tthis.state.videoIsPlaying = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_pauseSoundtrack',\n\t\t\tvalue: function _pauseSoundtrack() {\n\t\t\t\tif (this.state.audioIsPlaying) {\n\t\t\t\t\tthis.soundtrack.pause();\n\t\t\t\t\tthis.audioContext.suspend();\n\t\t\t\t\tthis.state.audioIsPlaying = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_pauseVideo',\n\t\t\tvalue: function _pauseVideo() {\n\t\t\t\tif (this.state.videoIsPlaying) {\n\t\t\t\t\tthis.video.pause();\n\t\t\t\t\tthis.state.videoIsPlaying = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_updateTotalTime',\n\t\t\tvalue: function _updateTotalTime() {\n\t\t\t\tthis.elements.timeTotal.innerText = (0, _helpers.formatSeconds)(this.timing.duration);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_updateWatchedTime',\n\t\t\tvalue: function _updateWatchedTime(seconds) {\n\t\t\t\tvar _timing = this.timing;\n\t\t\t\tvar watchedSeconds = _timing.watchedSeconds;\n\t\t\t\tvar prevWatchedSeconds = _timing.prevWatchedSeconds;\n\t\t\t\tvar duration = _timing.duration;\n\t\n\t\t\t\tif (Math.floor(prevWatchedSeconds) === Math.floor(watchedSeconds)) return;\n\t\t\t\tthis.elements.progressBar.style.transform = 'translate(' + (-100 + watchedSeconds / duration * 100) + '%, 0)';\n\t\t\t\tthis.elements.timeWatched.innerText = (0, _helpers.formatSeconds)(watchedSeconds);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_updateTiming',\n\t\t\tvalue: function _updateTiming() {\n\t\t\t\tvar timing = this.timing;\n\t\n\t\t\t\tvar currentFrameTimestamp = new Date();\n\t\n\t\t\t\tif (!timing.lastFrameTimestamp) {\n\t\t\t\t\ttiming.lastFrameTimestamp = currentFrameTimestamp;\n\t\t\t\t}\n\t\n\t\t\t\ttiming.prevWatchedSeconds = timing.watchedSeconds;\n\t\t\t\ttiming.watchedSeconds += (currentFrameTimestamp - timing.lastFrameTimestamp) / 1000;\n\t\t\t\ttiming.lastFrameTimestamp = currentFrameTimestamp;\n\t\n\t\t\t\tthis._updateWatchedTime();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_updateCanvas',\n\t\t\tvalue: function _updateCanvas() {\n\t\t\t\t// prepare canvas\n\t\t\t\tvar virtualCanvasContext = this.virtualCanvasContext;\n\t\t\t\tvar _canvasSize = this.canvasSize;\n\t\t\t\tvar width = _canvasSize.width;\n\t\t\t\tvar height = _canvasSize.height;\n\t\t\t\tvar watchedSeconds = this.timing.watchedSeconds;\n\t\n\t\t\t\t// check for what we need to display in current frame\n\t\n\t\t\t\tvar findFrameData = function findFrameData(time) {\n\t\t\t\t\treturn function (_ref2) {\n\t\t\t\t\t\tvar start = _ref2.start;\n\t\t\t\t\t\tvar end = _ref2.end;\n\t\t\t\t\t\treturn start <= time && end > time;\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t\tvar currentFrameData = this.timeline.find(findFrameData(watchedSeconds));\n\t\n\t\t\t\tif (currentFrameData.type === 'video') {\n\t\t\t\t\tthis._playVideo();\n\t\t\t\t\tthis.textWasDrawn = false;\n\t\t\t\t\tvirtualCanvasContext.drawImage(this.video, 0, 0, width, height);\n\t\t\t\t}\n\t\n\t\t\t\tif (currentFrameData.type === 'subtitles') {\n\t\t\t\t\tthis._pauseVideo();\n\t\t\t\t\tthis._drawSubtitles(currentFrameData.text);\n\t\t\t\t}\n\t\n\t\t\t\tthis._applyEffects();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_drawSubtitles',\n\t\t\tvalue: function _drawSubtitles(text) {\n\t\t\t\tif (this.textWasDrawn) return;\n\t\t\t\tvar virtualCanvasContext = this.virtualCanvasContext;\n\t\t\t\tvar _canvasSize2 = this.canvasSize;\n\t\t\t\tvar width = _canvasSize2.width;\n\t\t\t\tvar height = _canvasSize2.height;\n\t\n\t\t\t\tvirtualCanvasContext.fillStyle = '#000000';\n\t\t\t\tvirtualCanvasContext.fillRect(0, 0, width, height);\n\t\t\t\tvirtualCanvasContext.fillStyle = '#ffffff';\n\t\n\t\t\t\tvar heightStart = height * 0.1;\n\t\t\t\tvar widthStart = width * 0.05;\n\t\t\t\tvar lineHeight = 28;\n\t\n\t\t\t\tvirtualCanvasContext.font = '20px Oranienbaum';\n\t\n\t\t\t\ttext.split('\\n').map(function (row, i) {\n\t\t\t\t\tvirtualCanvasContext.fillText(row, widthStart, heightStart + i * lineHeight);\n\t\t\t\t});\n\t\n\t\t\t\tthis.textWasDrawn = true;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_applyEffects',\n\t\t\tvalue: function _applyEffects() {\n\t\t\t\tvar canvasContext = this.canvasContext;\n\t\t\t\tvar virtualCanvasContext = this.virtualCanvasContext;\n\t\t\t\tvar _canvasSize3 = this.canvasSize;\n\t\t\t\tvar width = _canvasSize3.width;\n\t\t\t\tvar height = _canvasSize3.height;\n\t\n\t\t\t\tvar grayscalePixelData = this._applyGrayscale(virtualCanvasContext.getImageData(0, 0, width, height));\n\t\t\t\tcanvasContext.putImageData(grayscalePixelData, 0, 0);\n\t\n\t\t\t\tdrawRandomArtifact(canvasContext, width, height);\n\t\t\t\tdrawRandomArtifact(canvasContext, width, height);\n\t\t\t\tdrawRandomArtifact(canvasContext, width, height);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_applyGrayscale',\n\t\t\tvalue: function _applyGrayscale(pixelData) {\n\t\t\t\tvar pixels = pixelData.data;\n\t\t\t\tvar pixelsLength = pixels.length;\n\t\t\t\tvar brightnessCoefficient = (0, _helpers.getRandom)(0.9, 1.1);\n\t\n\t\t\t\tfor (var i = 0; i < pixelsLength; i += 4) {\n\t\t\t\t\tvar r = pixels[i];\n\t\t\t\t\tvar g = pixels[i + 1];\n\t\t\t\t\tvar b = pixels[i + 2];\n\t\t\t\t\tvar a = pixels[i + 3];\n\t\t\t\t\tvar average = (0.21 * r + 0.72 * g + 0.07 * b) * brightnessCoefficient;\n\t\n\t\t\t\t\tpixels[i] = pixels[i + 1] = pixels[i + 2] = average;\n\t\t\t\t}\n\t\n\t\t\t\treturn pixelData;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_drawFrame',\n\t\t\tvalue: function _drawFrame() {\n\t\t\t\tvar _this4 = this;\n\t\n\t\t\t\tif (!this.isPlaying) return;\n\t\n\t\t\t\twindow.requestAnimationFrame(function () {\n\t\t\t\t\t_this4._updateTiming();\n\t\t\t\t\t_this4._updateCanvas();\n\t\t\t\t\t_this4._drawFrame();\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_computeCanvasSize',\n\t\t\tvalue: function _computeCanvasSize(videoSize) {\n\t\t\t\tvar fakeVideo = document.createElement('img');\n\t\t\t\tvar result = void 0;\n\t\t\t\tfakeVideo.classList.add(this.classes.fakeVideo.base);\n\t\t\t\tfakeVideo.width = this.video.videoWidth;\n\t\t\t\tfakeVideo.height = this.video.videoHeight;\n\t\t\t\tthis.elements.stage.appendChild(fakeVideo);\n\t\t\t\tresult = {\n\t\t\t\t\twidth: fakeVideo.clientWidth,\n\t\t\t\t\theight: fakeVideo.clientHeight\n\t\t\t\t};\n\t\t\t\tfakeVideo.parentNode.removeChild(fakeVideo);\n\t\t\t\treturn result;\n\t\t\t}\n\t\n\t\t\t// Public methods\n\t\n\t\t}, {\n\t\t\tkey: 'play',\n\t\t\tvalue: function play() {\n\t\t\t\tvar elements = this.elements;\n\t\t\t\tvar classes = this.classes;\n\t\n\t\n\t\t\t\tthis.lastFrameTimestamp = new Date();\n\t\t\t\tthis.isPlaying = true;\n\t\n\t\t\t\telements.playButton.classList.remove(classes.playButton.paused);\n\t\t\t\telements.playButton.classList.add(classes.playButton.playing);\n\t\n\t\t\t\tthis._playSoundtrack();\n\t\t\t\tthis._playVideo();\n\t\t\t\tthis._drawFrame();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'pause',\n\t\t\tvalue: function pause() {\n\t\t\t\tvar elements = this.elements;\n\t\t\t\tvar classes = this.classes;\n\t\n\t\n\t\t\t\tthis.isPlaying = false;\n\t\n\t\t\t\telements.playButton.classList.remove(classes.playButton.playing);\n\t\t\t\telements.playButton.classList.add(classes.playButton.paused);\n\t\n\t\t\t\tthis._pauseSoundtrack();\n\t\t\t\tthis._pauseVideo();\n\t\t\t}\n\t\t}]);\n\t\n\t\treturn Player;\n\t}();\n\t\n\texports.default = Player;\n\t\n\t\n\tfunction drawRandomArtifact(context, width, height) {\n\t\tvar center = {\n\t\t\tx: (0, _helpers.getRandomInt)(0, width),\n\t\t\ty: (0, _helpers.getRandomInt)(0, height)\n\t\t};\n\t\n\t\tvar coefficient = 2.5;\n\t\n\t\tvar firstPoint = {\n\t\t\tx: (0, _helpers.getRandomInt)(center.x - coefficient, center.x + coefficient),\n\t\t\ty: (0, _helpers.getRandomInt)(center.y - coefficient, center.y + coefficient)\n\t\t};\n\t\n\t\tvar secondPoint = {\n\t\t\tx: (0, _helpers.getRandomInt)(center.x - coefficient, center.x + coefficient),\n\t\t\ty: (0, _helpers.getRandomInt)(center.y - coefficient, center.y + coefficient)\n\t\t};\n\t\n\t\tvar baseColor = (0, _helpers.getRandomInt)(0, 150);\n\t\tcontext.strokeStyle = 'rgb(' + baseColor + ', ' + baseColor + ', ' + baseColor + ')';\n\t\tcontext.lineWidth = 10;\n\t\tcontext.beginPath();\n\t\tcontext.moveTo(firstPoint.x, firstPoint.y);\n\t\tcontext.quadraticCurveTo(center.x, center.y, secondPoint.x, secondPoint.y);\n\t\tcontext.stroke();\n\t}\n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** bundle.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap eef8a904ddc3ea516920\n **/","import Application from './modules/application';\r\n\r\ndocument.addEventListener('DOMContentLoaded', onDOMContentLoaded);\r\n\r\nfunction onDOMContentLoaded() {\r\n\twindow.application = new Application();\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./source/js/index.js\n **/","export function formatSeconds(seconds) {\r\n\tlet minutesCount = Math.floor(seconds / 60);\r\n\r\n\treturn `${formatXXNumber(minutesCount)}:${formatXXNumber(Math.round(seconds % 60))}`;\r\n}\r\n\r\nfunction formatXXNumber(number) {\r\n\tlet result;\r\n\r\n\tif (number < 10 && number >= 1) {\r\n\t\tresult = `0${Math.round(number)}`;\r\n\t} else if (number < 1) {\r\n\t\tresult = '00';\r\n\t} else {\r\n\t\tresult = number.toString();\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function formattedTimeToSeconds(timeString) {\r\n\tconst data = timeString.split(':');\r\n\tconst hours = parseInt(data[0], 10);\r\n\tconst minutes = parseInt(data[1], 10);\r\n\tconst seconds = Math.round(parseFloat(data[2].replace(',', '.'), 10));\r\n\r\n\treturn seconds + (minutes * 60) + (hours * 60 * 60);\r\n}\r\n\r\nexport function getRandomInt(min, max) {\r\n\treturn Math.floor(Math.random() * (max - min + 1)) + min;\r\n}\r\n\r\nexport function getRandom(min, max) {\r\n    return Math.random() * (max - min) + min;\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./source/js/helpers.js\n **/","import Player from './player';\r\n\r\nexport default class Application {\r\n\tconstructor(options = {}) {\r\n\t\tconst baseClass = options.baseClass || 'app';\r\n\t\tconst visiblePageClass = `${baseClass}__page_visible`;\r\n\r\n\t\tthis.root = document.querySelector(`.${baseClass}`);\r\n\t\tthis.form = this.root.querySelector(`.${baseClass}__form`);\r\n\t\tthis.pages = {\r\n\t\t\tstart: this.root.querySelector(`.${baseClass}__page_start`),\r\n\t\t\tmain: this.root.querySelector(`.${baseClass}__page_main`),\r\n\t\t};\r\n\r\n\t\tthis.links = {\r\n\t\t\tvideo: '',\r\n\t\t\tsubtitles: '',\r\n\t\t\tsoundtrack: '',\r\n\t\t}\r\n\r\n\t\tthis.form.addEventListener('submit', onFormSubmit.bind(this));\r\n\r\n\t\tfunction onFormSubmit(event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\t\r\n\t\t\tObject\r\n\t\t\t\t.keys(this.links)\r\n\t\t\t\t.forEach((type) => {\r\n\t\t\t\t\tthis.links[type] = this.form.querySelector(`[data-link-type=\"${type}\"]`).value;\r\n\t\t\t\t});\r\n\r\n\t\t\tthis.pages.start.classList.remove(visiblePageClass);\r\n\t\t\tthis.pages.main.classList.add(visiblePageClass);\r\n\r\n\t\t\twindow.player = this.player = new Player({\r\n\t\t\t\troot: this.root.querySelector('.player'),\r\n\t\t\t\tresources: this.links,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./source/js/modules/application.js\n **/","import {\r\n\tformatSeconds,\r\n\tformattedTimeToSeconds,\r\n\tgetRandomInt,\r\n\tgetRandom,\r\n} from '../helpers';\r\n\r\n\r\nconst DEFAULTS = {\r\n\tmaxCollisionLineLength: 150,\r\n};\r\n\r\nexport default class Player {\r\n\tconstructor({root, resources}) {\r\n\t\tconst baseClass = 'player';\r\n\t\tconst classes = this.classes = {\r\n\t\t\tbase: baseClass,\r\n\t\t\tstage: {\r\n\t\t\t\tbase: `${baseClass}__stage`,\r\n\t\t\t},\r\n\t\t\tcanvas: {\r\n\t\t\t\tbase: `${baseClass}__canvas`,\r\n\t\t\t},\r\n\t\t\tsubtitles: {\r\n\t\t\t\tbase: `${baseClass}__subtitles`,\r\n\t\t\t\tvisible: `${baseClass}__subtitles_visible`,\r\n\t\t\t},\r\n\t\t\tplayButton: {\r\n\t\t\t\tbase: `${baseClass}__control_state`,\r\n\t\t\t\tpaused: `${baseClass}__control_state_play`,\r\n\t\t\t\tplaying: `${baseClass}__control_state_pause`,\r\n\t\t\t},\r\n\t\t\tvideo: {\r\n\t\t\t\tbase: `${baseClass}__video`,\r\n\t\t\t},\r\n\t\t\ttime: {\r\n\t\t\t\tbase: 'time',\r\n\t\t\t\twatched: 'time__watched',\r\n\t\t\t\ttotal: 'time__total',\r\n\t\t\t},\r\n\t\t\tfakeVideo: {\r\n\t\t\t\tbase: `${baseClass}__fakeVideo`,\r\n\t\t\t},\r\n\t\t\tprogress: {\r\n\t\t\t\tbase: 'progress',\r\n\t\t\t\tbar: 'progress__bar',\r\n\t\t\t},\r\n\t\t};\r\n\r\n\t\tconst elements = this.elements = {\r\n\t\t\troot,\r\n\t\t\tstage: root.querySelector(`.${classes.stage.base}`),\r\n\t\t\tcanvas: root.querySelector(`.${classes.canvas.base}`),\r\n\t\t\tsubtitles: root.querySelector(`.${classes.subtitles.base}`),\r\n\t\t\tplayButton: root.querySelector(`.${classes.playButton.base}`),\r\n\t\t\ttimeWatched: root.querySelector(`.${classes.time.watched}`),\r\n\t\t\ttimeTotal: root.querySelector(`.${classes.time.total}`),\r\n\t\t\tprogressBar: root.querySelector(`.${classes.progress.bar}`),\r\n\t\t};\r\n\r\n\t\tthis.state = {\r\n\t\t\tvideoIsPlaying: false,\r\n\t\t\taudioIsPlaying: false,\r\n\t\t};\r\n\r\n\t\tthis.canvasContext = this.elements.canvas.getContext('2d');\r\n\r\n\t\tthis.isPlaying = false;\r\n\r\n\t\tPromise\r\n\t\t\t.all([\r\n\t\t\t\tthis._loadVideo(resources.video),\r\n\t\t\t\tthis._loadSoundtrack(resources.soundtrack),\r\n\t\t\t\tthis._loadSubtitles(resources.subtitles),\r\n\t\t\t])\r\n\t\t\t.then((result) => {\r\n\t\t\t\tthis.video = result[0];\r\n\t\t\t\tthis.soundtrack = result[1];\r\n\t\t\t\tthis.subtitles = result[2];\r\n\r\n\t\t\t\tthis._setupCanvas();\r\n\t\t\t\tthis._parseSubtitles();\r\n\t\t\t\tthis._setupTiming();\r\n\t\t\t\tthis._setupSound();\r\n\t\t\t\tthis._addEventListeners();\r\n\r\n\t\t\t\telements.root.classList.add(`${classes.base}_initialized`);\r\n\t\t\t\tthis.play();\r\n\t\t\t});\r\n\r\n\t\tthis._onPlayToggle = onPlayToggle.bind(this);\r\n\r\n\t\tfunction onPlayToggle(event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis[this.isPlaying ? 'pause': 'play']();\r\n\t\t}\r\n\r\n\t\tthis.counter = 0;\r\n\r\n\t\t// debug only\r\n\t\twindow.player = this;\r\n\t}\r\n\r\n\t_setupCanvas() {\r\n\t\tconst {video, canvasContext, elements: {canvas, stage}} = this;\r\n\t\tconst canvasSize = this.canvasSize = this._computeCanvasSize();\r\n\t\tconst virtualCanvas = this.virtualCanvas = document.createElement('canvas');\r\n\t\tconst virtualCanvasContext = this.virtualCanvasContext = this.virtualCanvas.getContext('2d');\r\n\r\n\t\tcanvas.width = canvasSize.width;\r\n\t\tcanvas.height = canvasSize.height;\r\n\t\tvirtualCanvas.width = canvasSize.width;\r\n\t\tvirtualCanvas.height = canvasSize.height;\r\n\r\n\t\tthis._drawFrame();\r\n\t}\r\n\r\n\t_parseSubtitles() {\r\n\t\tthis.subtitles = this.subtitles\r\n\t\t\t.split('\\n\\n')\r\n\t\t\t.map((slide) => {\r\n\t\t\t\tconst data = slide.split('\\n');\r\n\t\t\t\tconst timing = data[1].split(' --> ');\r\n\t\t\t\tconst result = {\r\n\t\t\t\t\tid: null,\r\n\t\t\t\t\tstart: null,\r\n\t\t\t\t\tend: null,\r\n\t\t\t\t\tduration: null,\r\n\t\t\t\t\ttext: null,\r\n\t\t\t\t};\r\n\r\n\t\t\t\tresult.id = parseInt(data[0], 10);\r\n\t\t\t\tresult.start = formattedTimeToSeconds(timing[0]);\r\n\t\t\t\tresult.duration = formattedTimeToSeconds(timing[1]) - result.start;\r\n\t\t\t\tresult.end = result.start + result.duration;\r\n\t\t\t\tresult.text = data.slice(2).join('\\n');\r\n\t\t\t\t\r\n\t\t\t\treturn result;\t\t\t\t\r\n\t\t\t});\r\n\t}\r\n\r\n\t_setupTiming() {\r\n\t\tconst subtitlesDuration = this.subtitles.reduce((result, slideData) => result + slideData.duration, 0);\r\n\t\tconst videoDuration = Math.round(this.video.duration);\r\n\t\tconst duration = videoDuration + subtitlesDuration;\r\n\r\n\t\tthis.timing = {\r\n\t\t\tduration,\r\n\t\t\twatchedSeconds: 0,\r\n\t\t\tprevWatchedSecond: 0,\r\n\t\t\tlastFrameTimestamp: null,\r\n\t\t};\r\n\r\n\t\tlet passedSubtitlesTime = 0;\r\n\t\tlet subtitlesSequenceTime = 0;\r\n\r\n\t\tthis.timeline = this.subtitles.reduce((result, slide, index, array) => {\r\n\t\t\tconst isLast = index === array.length - 1;\r\n\t\t\tconst nextSlide = array[index + 1];\r\n\t\t\tconst prevSlide = (array[index - 1] || {\r\n\t\t\t\tstart: 0,\r\n\t\t\t\tend: 0,\r\n\t\t\t\tduration: 0,\r\n\t\t\t\tisSynthethic: true,\r\n\t\t\t});\r\n\r\n\t\t\tconst prevEnd = prevSlide.end + passedSubtitlesTime;\r\n\t\t\tconst currentStart = slide.start + passedSubtitlesTime;\r\n\t\t\tconst currentEnd = slide.end + passedSubtitlesTime;\r\n\t\t\tconst nextStart = nextSlide && nextSlide.start + passedSubtitlesTime;\r\n\r\n\t\t\tif (prevSlide.end < slide.start) {\r\n\t\t\t\tresult.push({\r\n\t\t\t\t\tstart: prevEnd,\r\n\t\t\t\t\tend: currentStart,\r\n\t\t\t\t\ttype: 'video',\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// result.push({\r\n\t\t\t// \tstart: currentStart,\r\n\t\t\t// \tend: currentEnd,\r\n\t\t\t// \ttype: 'subtitles',\r\n\t\t\t// \ttext: slide.text,\r\n\t\t\t// });\r\n\r\n\t\t\t// result.push({\r\n\t\t\t// \tstart: currentEnd,\r\n\t\t\t// \tend: currentEnd + slide.duration,\r\n\t\t\t// \ttype: 'video',\r\n\t\t\t// });\r\n\r\n\t\t\tresult.push({\r\n\t\t\t\tstart: currentStart,\r\n\t\t\t\tend: currentEnd,\r\n\t\t\t\ttype: 'video',\r\n\t\t\t});\r\n\r\n\t\t\tresult.push({\r\n\t\t\t\tstart: currentEnd,\r\n\t\t\t\tend: currentEnd + slide.duration,\r\n\t\t\t\ttype: 'subtitles',\r\n\t\t\t\ttext: slide.text,\r\n\t\t\t});\r\n\r\n\t\t\tpassedSubtitlesTime += slide.duration + subtitlesSequenceTime;\r\n\r\n\t\t\tif (!nextSlide) {\r\n\t\t\t\tresult.push({\r\n\t\t\t\t\tstart: slide.end + passedSubtitlesTime,\r\n\t\t\t\t\tend: duration,\r\n\t\t\t\t\tduration: duration - slide.end + passedSubtitlesTime,\r\n\t\t\t\t\ttype: 'video',\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}, []);\r\n\r\n\t\tthis._updateTotalTime();\r\n\t}\r\n\r\n\t_setupSound() {\r\n\t\tconst audioContext = this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\r\n\t\tconst audioSource = this.audioSource = audioContext.createMediaElementSource(this.elements.audio);\r\n\t\tconst bufferSize = 4096;\r\n\t\tconst brownNoise = (function() {\r\n\t\t\tlet lastOut = 0.0;\r\n\t\t\tconst node = audioContext.createScriptProcessor(bufferSize, 1, 1);\r\n\t\t\tnode.onaudioprocess = function(e) {\r\n\t\t\t\tconst output = e.outputBuffer.getChannelData(0);\r\n\t\t\t\tfor (let i = 0; i < bufferSize; i++) {\r\n\t\t\t\t\tconst white = Math.random() * 2 - 1;\r\n\t\t\t\t\toutput[i] = (lastOut + (0.02 * white)) / 1.02;\r\n\t\t\t\t\tlastOut = output[i];\r\n\t\t\t\t\toutput[i] *= 0.5; // (roughly) compensate for gain\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn node;\r\n\t\t})();\r\n\r\n\t\tbrownNoise.connect(audioContext.destination);\r\n\r\n\t\tconst distortion = audioContext.createWaveShaper();\r\n\t\tconst biquadFilter = audioContext.createBiquadFilter();\r\n\t\tbiquadFilter.type = 'lowpass';\r\n\t\tbiquadFilter.frequency.value = 500;\r\n\t\tbiquadFilter.gain.value = 5;\r\n\r\n\t\taudioSource.connect(distortion);\r\n\t\tdistortion.connect(biquadFilter);\r\n\t\tbiquadFilter.connect(audioContext.destination);\r\n\t}\r\n\r\n\t_addEventListeners() {\r\n\t\tconst {elements} = this;\r\n\r\n\t\t// elements.playButton.addEventListener('click', this._onPlayToggle);\r\n\t\t// elements.stage.addEventListener('click', this._onPlayToggle);\r\n\t}\r\n\r\n\t_removeEventListeners() {\r\n\t\tconst {elements} = this;\r\n\r\n\t\t// elements.playButton.removeEventListener('click', this._onPlayButtonClick);\r\n\t\t// elements.stage.removeEventListener('click', this._onPlayToggle);\r\n\t}\r\n\r\n\t_loadVideo(url) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst {elements} = this;\r\n\t\t\tconst video = document.createElement('video');\r\n\t\t\tvideo.defaultMuted = true;\r\n\t\t\tvideo.classList.add(this.classes.video.base);\r\n\t\t\telements.stage.appendChild(video);\r\n\r\n\t\t\tvideo.addEventListener('error', reject);\r\n\t\t\tvideo.addEventListener('canplaythrough', (event) => {\r\n\t\t\t\tresolve(video);\r\n\t\t\t});\r\n\r\n\t\t\tvideo.src = url;\r\n\t\t});\r\n\t}\r\n\r\n\t_loadSoundtrack(url) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst {elements} = this;\r\n\t\t\tconst audio = elements.audio = document.createElement('audio');\r\n\t\t\taudio.classList.add(`${this.classes.base}__audio`);\r\n\t\t\telements.stage.appendChild(audio);\r\n\r\n\t\t\taudio.addEventListener('error', reject);\r\n\t\t\taudio.addEventListener('canplaythrough', (event) => {\r\n\t\t\t\taudio.loop = true;\r\n\t\t\t\tresolve(audio);\r\n\t\t\t});\r\n\r\n\t\t\taudio.src = url;\r\n\t\t});\r\n\t}\r\n\r\n\t_loadSubtitles(url) {\r\n\t\treturn fetch(url).then((response) => {\r\n\t\t\treturn response.text();\r\n\t\t});\r\n\t}\r\n\r\n\t_playSoundtrack() {\r\n\t\tif (!this.state.audioIsPlaying) {\r\n\t\t\tthis.soundtrack.play();\r\n\t\t\tthis.audioContext.resume();\r\n\t\t\tthis.state.audioIsPlaying = true;\r\n\t\t}\r\n\t}\r\n\r\n\t_playVideo() {\r\n\t\tif (!this.state.videoIsPlaying) {\r\n\t\t\tthis.video.play();\r\n\t\t\tthis.state.videoIsPlaying = true;\r\n\t\t}\r\n\t}\r\n\r\n\t_pauseSoundtrack() {\r\n\t\tif (this.state.audioIsPlaying) {\r\n\t\t\tthis.soundtrack.pause();\r\n\t\t\tthis.audioContext.suspend();\r\n\t\t\tthis.state.audioIsPlaying = false;\r\n\t\t}\r\n\t}\r\n\r\n\t_pauseVideo() {\r\n\t\tif (this.state.videoIsPlaying) {\r\n\t\t\tthis.video.pause();\r\n\t\t\tthis.state.videoIsPlaying = false;\r\n\t\t}\r\n\t}\r\n\r\n\t_updateTotalTime() {\r\n\t\tthis.elements.timeTotal.innerText = formatSeconds(this.timing.duration);\r\n\t}\r\n\r\n\t_updateWatchedTime(seconds) {\r\n\t\tconst {watchedSeconds, prevWatchedSeconds, duration} = this.timing;\r\n\t\tif (Math.floor(prevWatchedSeconds) === Math.floor(watchedSeconds)) return;\r\n\t\tthis.elements.progressBar.style.transform = `translate(${-100 + (watchedSeconds / duration * 100)}%, 0)`;\r\n\t\tthis.elements.timeWatched.innerText = formatSeconds(watchedSeconds);\r\n\t}\r\n\r\n\t_updateTiming() {\r\n\t\tconst {timing} = this;\r\n\t\tconst currentFrameTimestamp = new Date();\r\n\r\n\t\tif (!timing.lastFrameTimestamp) {\r\n\t\t\ttiming.lastFrameTimestamp = currentFrameTimestamp;\r\n\t\t}\r\n\r\n\t\ttiming.prevWatchedSeconds = timing.watchedSeconds;\r\n\t\ttiming.watchedSeconds += (currentFrameTimestamp - timing.lastFrameTimestamp) / 1000;\r\n\t\ttiming.lastFrameTimestamp = currentFrameTimestamp;\r\n\r\n\t\tthis._updateWatchedTime();\r\n\t}\r\n\r\n\t_updateCanvas() {\r\n\t\t// prepare canvas\r\n\t\tconst {\r\n\t\t\tvirtualCanvasContext,\r\n\t\t\tcanvasSize: {\r\n\t\t\t\twidth,\r\n\t\t\t\theight\r\n\t\t\t},\r\n\t\t\ttiming: {\r\n\t\t\t\twatchedSeconds,\r\n\t\t\t},\r\n\t\t} = this;\r\n\r\n\t\t// check for what we need to display in current frame\r\n\t\tconst findFrameData = (time) => ({start, end}) => start <= time && end > time;\r\n\t\tconst currentFrameData = this.timeline.find(findFrameData(watchedSeconds));\r\n\r\n\t\tif (currentFrameData.type === 'video') {\r\n\t\t\tthis._playVideo();\r\n\t\t\tthis.textWasDrawn = false;\r\n\t\t\tvirtualCanvasContext.drawImage(this.video, 0, 0, width, height);\r\n\t\t}\r\n\r\n\t\tif (currentFrameData.type === 'subtitles') {\r\n\t\t\tthis._pauseVideo();\r\n\t\t\tthis._drawSubtitles(currentFrameData.text);\r\n\t\t}\r\n\r\n\t\tthis._applyEffects();\r\n\t}\r\n\r\n\t_drawSubtitles(text) {\r\n\t\tif (this.textWasDrawn) return;\r\n\t\tconst {virtualCanvasContext, canvasSize: {width, height}} = this;\r\n\t\tvirtualCanvasContext.fillStyle = '#000000';\r\n\t\tvirtualCanvasContext.fillRect(0, 0, width, height);\r\n\t\tvirtualCanvasContext.fillStyle = '#ffffff';\r\n\r\n\t\tconst heightStart = height * 0.1;\r\n\t\tconst widthStart = width * 0.05;\r\n\t\tconst lineHeight = 28;\r\n\r\n\t\tvirtualCanvasContext.font = '20px Oranienbaum';\r\n\r\n\t\ttext\r\n\t\t\t.split('\\n')\r\n\t\t\t.map((row, i) => {\r\n\t\t\t\tvirtualCanvasContext.fillText(row, widthStart, heightStart + i * lineHeight);\r\n\t\t\t});\r\n\r\n\t\tthis.textWasDrawn = true;\r\n\t}\r\n\r\n\t_applyEffects() {\r\n\t\tconst {canvasContext, virtualCanvasContext, canvasSize: {width, height}} = this;\r\n\t\tconst grayscalePixelData = this._applyGrayscale(virtualCanvasContext.getImageData(0, 0, width, height));\r\n\t\tcanvasContext.putImageData(grayscalePixelData, 0, 0);\r\n\r\n\t\tdrawRandomArtifact(canvasContext, width, height);\r\n\t\tdrawRandomArtifact(canvasContext, width, height);\r\n\t\tdrawRandomArtifact(canvasContext, width, height);\r\n\t}\r\n\r\n\t_applyGrayscale(pixelData) {\r\n\t\tconst pixels = pixelData.data;\r\n\t\tconst pixelsLength = pixels.length;\r\n\t\tconst brightnessCoefficient = getRandom(0.9, 1.1);\r\n\r\n\t\tfor (let i = 0; i < pixelsLength; i += 4) {\r\n\t\t\tconst r = pixels[i];\r\n\t\t\tconst g = pixels[i + 1];\r\n\t\t\tconst b = pixels[i + 2];\r\n\t\t\tconst a = pixels[i + 3];\r\n\t\t\tconst average = (0.21 * r + 0.72 * g + 0.07 * b) * brightnessCoefficient;\r\n\r\n\t\t\tpixels[i] = pixels[i + 1] = pixels[i + 2] = average;\r\n\t\t}\r\n\r\n\t\treturn pixelData;\r\n\t}\r\n\r\n\t_drawFrame() {\r\n\t\tif (!this.isPlaying) return;\r\n\r\n\t\twindow.requestAnimationFrame(() => {\r\n\t\t\tthis._updateTiming();\r\n\t\t\tthis._updateCanvas();\r\n\t\t\tthis._drawFrame();\r\n\t\t});\r\n\t}\r\n\r\n\t_computeCanvasSize(videoSize) {\r\n\t\tconst fakeVideo = document.createElement('img');\r\n\t\tlet result;\r\n\t\tfakeVideo.classList.add(this.classes.fakeVideo.base);\r\n\t\tfakeVideo.width = this.video.videoWidth;\r\n\t\tfakeVideo.height = this.video.videoHeight;\r\n\t\tthis.elements.stage.appendChild(fakeVideo);\r\n\t\tresult = {\r\n\t\t\twidth: fakeVideo.clientWidth,\r\n\t\t\theight: fakeVideo.clientHeight,\r\n\t\t};\r\n\t\tfakeVideo.parentNode.removeChild(fakeVideo);\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// Public methods\r\n\r\n\tplay() {\r\n\t\tconst {elements, classes} = this;\r\n\r\n\t\tthis.lastFrameTimestamp = new Date();\r\n\t\tthis.isPlaying = true;\r\n\r\n\t\telements.playButton.classList.remove(classes.playButton.paused);\r\n\t\telements.playButton.classList.add(classes.playButton.playing);\r\n\r\n\t\tthis._playSoundtrack();\r\n\t\tthis._playVideo();\r\n\t\tthis._drawFrame();\r\n\t}\r\n\r\n\tpause() {\r\n\t\tconst {elements, classes} = this;\r\n\r\n\t\tthis.isPlaying = false;\r\n\r\n\t\telements.playButton.classList.remove(classes.playButton.playing);\r\n\t\telements.playButton.classList.add(classes.playButton.paused);\r\n\r\n\t\tthis._pauseSoundtrack();\r\n\t\tthis._pauseVideo();\r\n\t}\r\n}\r\n\r\nfunction drawRandomArtifact(context, width, height) {\r\n\tconst center = {\r\n\t\tx: getRandomInt(0, width),\r\n\t\ty: getRandomInt(0, height),\r\n\t};\r\n\r\n\tconst coefficient = 2.5;\r\n\r\n\tconst firstPoint = {\r\n\t\tx: getRandomInt(center.x - coefficient, center.x + coefficient),\r\n\t\ty: getRandomInt(center.y - coefficient, center.y + coefficient),\r\n\t};\r\n\r\n\tconst secondPoint = {\r\n\t\tx: getRandomInt(center.x - coefficient, center.x + coefficient),\r\n\t\ty: getRandomInt(center.y - coefficient, center.y + coefficient),\r\n\t};\r\n\r\n\tconst baseColor = getRandomInt(0, 150);\r\n\tcontext.strokeStyle = `rgb(${baseColor}, ${baseColor}, ${baseColor})`;\r\n\tcontext.lineWidth = 10;\r\n\tcontext.beginPath();\r\n\t\tcontext.moveTo(firstPoint.x, firstPoint.y);\r\n\t\tcontext.quadraticCurveTo(\r\n\t\t\tcenter.x,\r\n\t\t\tcenter.y,\r\n\t\t\tsecondPoint.x,\r\n\t\t\tsecondPoint.y\r\n\t\t);\r\n\tcontext.stroke();\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./source/js/modules/player.js\n **/"],"sourceRoot":""}