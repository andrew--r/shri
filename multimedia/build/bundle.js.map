{"version":3,"sources":["webpack:///bundle.js","webpack:///webpack/bootstrap dfda00a6aea96aee834a","webpack:///./source/js/index.js","webpack:///./source/js/helpers.js","webpack:///./source/js/modules/application.js","webpack:///./source/js/modules/player.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","onDOMContentLoaded","window","application","_application2","_application","document","addEventListener","formatSeconds","seconds","minutesCount","Math","floor","formatXXNumber","round","number","result","toString","formattedTimeToSeconds","timeString","data","split","hours","parseInt","minutes","parseFloat","replace","getRandomInt","min","max","random","getRandom","Object","defineProperty","value","webgl","createShader","glContext","sourceCode","shaderType","shader","shaderSource","compileShader","compiledSuccessfully","getShaderParameter","COMPILE_STATUS","Error","getShaderInfoLog","createProgram","vertexShader","fragmentShader","program","attachShader","linkProgram","linkedSuccessfully","getProgramParameter","LINK_STATUS","getProgramInfoLog","_classCallCheck","instance","Constructor","TypeError","_player","_player2","Application","onFormSubmit","event","_this","this","preventDefault","keys","links","forEach","type","form","querySelector","pages","start","classList","remove","visiblePageClass","main","add","player","root","resources","options","arguments","length","undefined","baseClass","video","subtitles","soundtrack","bind","loadVideo","url","Promise","resolve","reject","createElement","muted","src","loadAudio","audio","loop","loadTextFile","fetch","then","response","text","parseSubtitles","source","map","slide","timing","end","duration","_helpers","slice","join","computeTimeline","parsedSubtitles","totalDuration","passedSubtitlesTime","reduce","index","array","nextSlide","prevSlide","isSynthethic","prevEnd","currentStart","currentEnd","push","drawRandomArtifact","context","width","height","center","x","y","halfSize","firstPoint","secondPoint","baseColor","strokeStyle","lineWidth","beginPath","moveTo","quadraticCurveTo","stroke","drawRandomScratch","_createClass","defineProperties","target","props","i","descriptor","enumerable","configurable","writable","key","protoProps","staticProps","prototype","classes","base","stage","canvas","playButton","paused","playing","time","watched","total","fakeVideo","progress","bar","Player","_ref","elements","timeWatched","timeTotal","progressBar","state","isPlaying","videoIsPlaying","audioIsPlaying","all","_addEventListeners","_setupCanvas","_setupTiming","_setupSound","play","_this2","playControls","control","virtualCanvas","getContext","virtualContext","videoWidth","videoHeight","subtitlesDuration","slideData","videoDuration","watchedSeconds","prevWatchedSecond","lastFrameTimestamp","timeline","innerText","audioContext","AudioContext","webkitAudioContext","audioSource","createMediaElementSource","brownNoise","bufferSize","lastOut","node","createScriptProcessor","onaudioprocess","e","output","outputBuffer","getChannelData","white","connect","destination","biquadFilter","createBiquadFilter","frequency","gain","resume","pause","suspend","currentFrameTimestamp","Date","prevWatchedSeconds","_updateWatchedTime","_timing","style","transform","_elements$canvas","findFrameData","_ref2","currentFrameData","find","clearRect","_playVideo","textWasDrawn","drawImage","_pauseVideo","_drawSubtitles","_applyEffects","_elements$canvas2","fillStyle","font","fillRect","rows","mostWideRow","string","currentRow","lineHeight","positionY","positionX","measureText","row","fillText","_elements$virtualCanv","globalCompositeOperation","globalAlpha","pixelData","pixels","pixelsLength","brightnessCoefficient","r","g","b","average","_this3","requestAnimationFrame","_updateTiming","_updateCanvas","_drawFrame","_playSoundtrack","_this4","_pauseSoundtrack"],"mappings":"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","file":"bundle.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _application = __webpack_require__(2);\n\t\n\tvar _application2 = _interopRequireDefault(_application);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tdocument.addEventListener('DOMContentLoaded', onDOMContentLoaded);\n\t\n\tfunction onDOMContentLoaded() {\n\t\twindow.application = new _application2.default();\n\t}\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\texports.formatSeconds = formatSeconds;\n\texports.formattedTimeToSeconds = formattedTimeToSeconds;\n\texports.getRandomInt = getRandomInt;\n\texports.getRandom = getRandom;\n\tfunction formatSeconds(seconds) {\n\t\tvar minutesCount = Math.floor(seconds / 60);\n\t\n\t\treturn formatXXNumber(minutesCount) + ':' + formatXXNumber(Math.round(seconds % 60));\n\t}\n\t\n\tfunction formatXXNumber(number) {\n\t\tvar result = void 0;\n\t\n\t\tif (number < 10 && number >= 1) {\n\t\t\tresult = '0' + Math.round(number);\n\t\t} else if (number < 1) {\n\t\t\tresult = '00';\n\t\t} else {\n\t\t\tresult = number.toString();\n\t\t}\n\t\n\t\treturn result;\n\t}\n\t\n\tfunction formattedTimeToSeconds(timeString) {\n\t\tvar data = timeString.split(':');\n\t\tvar hours = parseInt(data[0], 10);\n\t\tvar minutes = parseInt(data[1], 10);\n\t\tvar seconds = Math.round(parseFloat(data[2].replace(',', '.'), 10));\n\t\n\t\treturn seconds + minutes * 60 + hours * 60 * 60;\n\t}\n\t\n\tfunction getRandomInt(min, max) {\n\t\treturn Math.floor(Math.random() * (max - min + 1)) + min;\n\t}\n\t\n\tfunction getRandom(min, max) {\n\t\treturn Math.random() * (max - min) + min;\n\t}\n\t\n\tvar webgl = exports.webgl = {\n\t\tcreateShader: function createShader(glContext, sourceCode, shaderType) {\n\t\t\tvar shader = glContext.createShader(shaderType);\n\t\t\tglContext.shaderSource(shader, sourceCode);\n\t\t\tglContext.compileShader(shader);\n\t\t\tvar compiledSuccessfully = glContext.getShaderParameter(shader, glContext.COMPILE_STATUS);\n\t\n\t\t\tif (!compiledSuccessfully) {\n\t\t\t\tthrow new Error('Could not compile shader: ', glContext.getShaderInfoLog(shader));\n\t\t\t}\n\t\n\t\t\treturn shader;\n\t\t},\n\t\tcreateProgram: function createProgram(glContext, vertexShader, fragmentShader) {\n\t\t\tvar program = glContext.createProgram();\n\t\n\t\t\tglContext.attachShader(program, vertexShader);\n\t\t\tglContext.attachShader(program, fragmentShader);\n\t\n\t\t\tglContext.linkProgram(program);\n\t\n\t\t\tvar linkedSuccessfully = glContext.getProgramParameter(program, glContext.LINK_STATUS);\n\t\n\t\t\tif (!linkedSuccessfully) {\n\t\t\t\tthrow new Error('Program failed to link: ', glContext.getProgramInfoLog(program));\n\t\t\t}\n\t\n\t\t\treturn program;\n\t\t}\n\t};\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\t\n\tvar _player = __webpack_require__(3);\n\t\n\tvar _player2 = _interopRequireDefault(_player);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar Application = function Application() {\n\t\tvar options = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n\t\n\t\t_classCallCheck(this, Application);\n\t\n\t\tvar baseClass = options.baseClass || 'app';\n\t\tvar visiblePageClass = baseClass + '__page_visible';\n\t\n\t\tthis.root = document.querySelector('.' + baseClass);\n\t\tthis.form = this.root.querySelector('.' + baseClass + '__form');\n\t\tthis.pages = {\n\t\t\tstart: this.root.querySelector('.' + baseClass + '__page_start'),\n\t\t\tmain: this.root.querySelector('.' + baseClass + '__page_main')\n\t\t};\n\t\n\t\tthis.links = {\n\t\t\tvideo: '',\n\t\t\tsubtitles: '',\n\t\t\tsoundtrack: ''\n\t\t};\n\t\n\t\tthis.form.addEventListener('submit', onFormSubmit.bind(this));\n\t\n\t\tfunction onFormSubmit(event) {\n\t\t\tvar _this = this;\n\t\n\t\t\tevent.preventDefault();\n\t\n\t\t\tObject.keys(this.links).forEach(function (type) {\n\t\t\t\t_this.links[type] = _this.form.querySelector('[data-link-type=\"' + type + '\"]').value;\n\t\t\t});\n\t\n\t\t\tthis.pages.start.classList.remove(visiblePageClass);\n\t\t\tthis.pages.main.classList.add(visiblePageClass);\n\t\n\t\t\twindow.player = this.player = new _player2.default({\n\t\t\t\troot: this.root.querySelector('.player'),\n\t\t\t\tresources: this.links\n\t\t\t});\n\t\t}\n\t};\n\t\n\texports.default = Application;\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _helpers = __webpack_require__(1);\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar baseClass = 'player';\n\tvar classes = {\n\t\tbase: baseClass,\n\t\tstage: {\n\t\t\tbase: baseClass + '__stage'\n\t\t},\n\t\tcanvas: {\n\t\t\tbase: baseClass + '__canvas'\n\t\t},\n\t\tplayButton: {\n\t\t\tbase: baseClass + '__control_state',\n\t\t\tpaused: baseClass + '__control_state_play',\n\t\t\tplaying: baseClass + '__control_state_pause'\n\t\t},\n\t\ttime: {\n\t\t\tbase: 'time',\n\t\t\twatched: 'time__watched',\n\t\t\ttotal: 'time__total'\n\t\t},\n\t\tfakeVideo: {\n\t\t\tbase: baseClass + '__fakeVideo'\n\t\t},\n\t\tprogress: {\n\t\t\tbase: 'progress',\n\t\t\tbar: 'progress__bar'\n\t\t}\n\t};\n\t\n\tvar Player = function () {\n\t\t/**\r\n\t  * @param {Object} root - root DOM node for player\r\n\t  * @param {Object} resources - list of resources urls to use (video, soundtrack, subtitles)\r\n\t  */\n\t\n\t\tfunction Player(_ref) {\n\t\t\tvar _this = this;\n\t\n\t\t\tvar root = _ref.root;\n\t\t\tvar resources = _ref.resources;\n\t\n\t\t\t_classCallCheck(this, Player);\n\t\n\t\t\tthis.elements = {\n\t\t\t\troot: root,\n\t\t\t\tstage: root.querySelector('.' + classes.stage.base),\n\t\t\t\tcanvas: root.querySelector('.' + classes.canvas.base),\n\t\t\t\tplayButton: root.querySelector('.' + classes.playButton.base),\n\t\t\t\ttimeWatched: root.querySelector('.' + classes.time.watched),\n\t\t\t\ttimeTotal: root.querySelector('.' + classes.time.total),\n\t\t\t\tprogressBar: root.querySelector('.' + classes.progress.bar)\n\t\t\t};\n\t\n\t\t\tthis.state = {\n\t\t\t\tisPlaying: false,\n\t\t\t\tvideoIsPlaying: false,\n\t\t\t\taudioIsPlaying: false\n\t\t\t};\n\t\n\t\t\tPromise.all([loadVideo(resources.video), loadAudio(resources.soundtrack), loadTextFile(resources.subtitles)]).then(function (result) {\n\t\t\t\t_this.video = result[0];\n\t\t\t\t_this.audio = result[1];\n\t\t\t\t_this.subtitles = parseSubtitles(result[2]);\n\t\n\t\t\t\t_this._addEventListeners();\n\t\t\t\t_this._setupCanvas();\n\t\t\t\t_this._setupTiming();\n\t\t\t\t_this._setupSound();\n\t\n\t\t\t\t_this.elements.root.classList.add(classes.base + '_initialized');\n\t\t\t\t_this.play();\n\t\t\t});\n\t\t}\n\t\n\t\t_createClass(Player, [{\n\t\t\tkey: '_addEventListeners',\n\t\t\tvalue: function _addEventListeners() {\n\t\t\t\tvar _this2 = this;\n\t\n\t\t\t\tvar elements = this.elements;\n\t\n\t\t\t\tvar playControls = [elements.playButton, elements.stage];\n\t\n\t\t\t\tplayControls.map(function (control) {\n\t\t\t\t\treturn control.addEventListener('click', function () {\n\t\t\t\t\t\t_this2[_this2.state.isPlaying ? 'pause' : 'play']();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\n\t\t\t/**\r\n\t   * Creates all contexts and sets sizes\r\n\t   */\n\t\n\t\t}, {\n\t\t\tkey: '_setupCanvas',\n\t\t\tvalue: function _setupCanvas() {\n\t\t\t\tvar video = this.video;\n\t\t\t\tvar elements = this.elements;\n\t\n\t\n\t\t\t\tvar virtualCanvas = elements.virtualCanvas = document.createElement('canvas');\n\t\n\t\t\t\tthis.context = elements.canvas.getContext('2d');\n\t\t\t\tthis.virtualContext = virtualCanvas.getContext('2d');\n\t\n\t\t\t\telements.canvas.width = virtualCanvas.width = video.videoWidth;\n\t\t\t\telements.canvas.height = virtualCanvas.height = video.videoHeight;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_setupTiming',\n\t\t\tvalue: function _setupTiming() {\n\t\t\t\tvar subtitlesDuration = this.subtitles.reduce(function (result, slideData) {\n\t\t\t\t\treturn result + slideData.duration;\n\t\t\t\t}, 0);\n\t\t\t\tvar videoDuration = Math.round(this.video.duration);\n\t\t\t\tvar duration = videoDuration + subtitlesDuration;\n\t\n\t\t\t\tthis.timing = {\n\t\t\t\t\tduration: duration,\n\t\t\t\t\twatchedSeconds: 0,\n\t\t\t\t\tprevWatchedSecond: 0,\n\t\t\t\t\tlastFrameTimestamp: null\n\t\t\t\t};\n\t\n\t\t\t\tthis.timeline = computeTimeline(this.subtitles, duration);\n\t\t\t\tthis.elements.timeTotal.innerText = (0, _helpers.formatSeconds)(this.timing.duration);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_setupSound',\n\t\t\tvalue: function _setupSound() {\n\t\t\t\tvar audioContext = this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n\t\t\t\tvar audioSource = this.audioSource = audioContext.createMediaElementSource(this.audio);\n\t\t\t\tvar brownNoise = function () {\n\t\t\t\t\tvar bufferSize = 4096;\n\t\t\t\t\tvar lastOut = 0.0;\n\t\t\t\t\tvar node = audioContext.createScriptProcessor(bufferSize, 1, 1);\n\t\t\t\t\tnode.onaudioprocess = function (e) {\n\t\t\t\t\t\tvar output = e.outputBuffer.getChannelData(0);\n\t\t\t\t\t\tfor (var i = 0; i < bufferSize; i++) {\n\t\t\t\t\t\t\tvar white = Math.random() * 2 - 1;\n\t\t\t\t\t\t\toutput[i] = (lastOut + 0.02 * white) / 1.02;\n\t\t\t\t\t\t\tlastOut = output[i];\n\t\t\t\t\t\t\toutput[i] *= 0.25; // (roughly) compensate for gain\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\treturn node;\n\t\t\t\t}();\n\t\n\t\t\t\tbrownNoise.connect(audioContext.destination);\n\t\n\t\t\t\tvar biquadFilter = audioContext.createBiquadFilter();\n\t\t\t\tbiquadFilter.type = 'highpass';\n\t\t\t\tbiquadFilter.frequency.value = 900;\n\t\t\t\tbiquadFilter.gain.value = 5;\n\t\n\t\t\t\taudioSource.connect(biquadFilter);\n\t\t\t\tbiquadFilter.connect(audioContext.destination);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_playSoundtrack',\n\t\t\tvalue: function _playSoundtrack() {\n\t\t\t\tif (!this.state.audioIsPlaying) {\n\t\t\t\t\tthis.audio.play();\n\t\t\t\t\tthis.audioContext.resume();\n\t\t\t\t\tthis.state.audioIsPlaying = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_playVideo',\n\t\t\tvalue: function _playVideo() {\n\t\t\t\tif (!this.state.videoIsPlaying) {\n\t\t\t\t\tthis.state.videoIsPlaying = true;\n\t\t\t\t\tthis.video.play();\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_pauseSoundtrack',\n\t\t\tvalue: function _pauseSoundtrack() {\n\t\t\t\tif (this.state.audioIsPlaying) {\n\t\t\t\t\tthis.audio.pause();\n\t\t\t\t\tthis.audioContext.suspend();\n\t\t\t\t\tthis.state.audioIsPlaying = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_pauseVideo',\n\t\t\tvalue: function _pauseVideo() {\n\t\t\t\tif (this.state.videoIsPlaying) {\n\t\t\t\t\tthis.state.videoIsPlaying = false;\n\t\t\t\t\tthis.video.pause();\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_updateTiming',\n\t\t\tvalue: function _updateTiming() {\n\t\t\t\tvar timing = this.timing;\n\t\n\t\t\t\tvar currentFrameTimestamp = new Date();\n\t\n\t\t\t\tif (!timing.lastFrameTimestamp) {\n\t\t\t\t\ttiming.lastFrameTimestamp = currentFrameTimestamp;\n\t\t\t\t}\n\t\n\t\t\t\ttiming.prevWatchedSeconds = timing.watchedSeconds;\n\t\t\t\ttiming.watchedSeconds += (currentFrameTimestamp - timing.lastFrameTimestamp) / 1000;\n\t\t\t\ttiming.lastFrameTimestamp = currentFrameTimestamp;\n\t\n\t\t\t\tthis._updateWatchedTime();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_updateWatchedTime',\n\t\t\tvalue: function _updateWatchedTime(seconds) {\n\t\t\t\tvar _timing = this.timing;\n\t\t\t\tvar watchedSeconds = _timing.watchedSeconds;\n\t\t\t\tvar prevWatchedSeconds = _timing.prevWatchedSeconds;\n\t\t\t\tvar duration = _timing.duration;\n\t\n\t\t\t\tif (Math.floor(prevWatchedSeconds) === Math.floor(watchedSeconds)) return;\n\t\t\t\tthis.elements.progressBar.style.transform = 'translate(' + (-100 + watchedSeconds / duration * 100) + '%, 0)';\n\t\t\t\tthis.elements.timeWatched.innerText = (0, _helpers.formatSeconds)(watchedSeconds);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_updateCanvas',\n\t\t\tvalue: function _updateCanvas() {\n\t\t\t\tvar elements = this.elements;\n\t\t\t\tvar virtualContext = this.virtualContext;\n\t\t\t\tvar timing = this.timing;\n\t\t\t\tvar _elements$canvas = elements.canvas;\n\t\t\t\tvar width = _elements$canvas.width;\n\t\t\t\tvar height = _elements$canvas.height;\n\t\n\t\n\t\t\t\tvar findFrameData = function findFrameData(time) {\n\t\t\t\t\treturn function (_ref2) {\n\t\t\t\t\t\tvar start = _ref2.start;\n\t\t\t\t\t\tvar end = _ref2.end;\n\t\t\t\t\t\treturn start <= time && end > time;\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t\tvar currentFrameData = this.timeline.find(findFrameData(timing.watchedSeconds));\n\t\n\t\t\t\tvirtualContext.clearRect(0, 0, width, height);\n\t\n\t\t\t\tif (currentFrameData.type === 'video') {\n\t\t\t\t\tthis._playVideo();\n\t\t\t\t\tthis.textWasDrawn = false;\n\t\t\t\t\tvirtualContext.drawImage(this.video, 0, 0, width, height);\n\t\t\t\t}\n\t\n\t\t\t\tif (currentFrameData.type === 'subtitles') {\n\t\t\t\t\tthis._pauseVideo();\n\t\t\t\t\tthis._drawSubtitles(currentFrameData.text);\n\t\t\t\t}\n\t\n\t\t\t\tthis._applyEffects();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_drawSubtitles',\n\t\t\tvalue: function _drawSubtitles(text) {\n\t\t\t\tvar virtualContext = this.virtualContext;\n\t\t\t\tvar elements = this.elements;\n\t\t\t\tvar _elements$canvas2 = elements.canvas;\n\t\t\t\tvar width = _elements$canvas2.width;\n\t\t\t\tvar height = _elements$canvas2.height;\n\t\n\t\n\t\t\t\tvirtualContext.fillStyle = '#000000';\n\t\t\t\tvirtualContext.font = '22px Oranienbaum';\n\t\t\t\tvirtualContext.fillRect(0, 0, width, height);\n\t\t\t\tvirtualContext.fillStyle = '#ffffff';\n\t\n\t\t\t\tvar rows = text.split('\\n');\n\t\t\t\tvar mostWideRow = rows.reduce(function (string, currentRow) {\n\t\t\t\t\treturn currentRow.length > string.length ? currentRow : string;\n\t\t\t\t}, '');\n\t\t\t\tvar lineHeight = 28;\n\t\n\t\t\t\tvar positionY = height / 2 - rows.length * lineHeight / 2;\n\t\t\t\tvar positionX = width / 2 - virtualContext.measureText(mostWideRow).width / 2;\n\t\n\t\t\t\trows.map(function (row, i) {\n\t\t\t\t\tvirtualContext.fillText(row, positionX, positionY + i * lineHeight);\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_applyEffects',\n\t\t\tvalue: function _applyEffects() {\n\t\t\t\tvar context = this.context;\n\t\t\t\tvar elements = this.elements;\n\t\t\t\tvar _elements$virtualCanv = elements.virtualCanvas;\n\t\t\t\tvar width = _elements$virtualCanv.width;\n\t\t\t\tvar height = _elements$virtualCanv.height;\n\t\n\t\t\t\t// current frame\n\t\n\t\t\t\tcontext.drawImage(elements.virtualCanvas, 0, 0, width, height);\n\t\n\t\t\t\tcontext.globalCompositeOperation = 'color';\n\t\n\t\t\t\t// overlay for grayscale filter\n\t\t\t\tcontext.fillStyle = '#ffffff';\n\t\t\t\tcontext.fillRect(0, 0, width, height);\n\t\n\t\t\t\tcontext.globalCompositeOperation = 'source-over';\n\t\n\t\t\t\t// overlay for blinking\n\t\t\t\tcontext.globalAlpha = (0, _helpers.getRandom)(0, 0.2);\n\t\t\t\tcontext.fillStyle = '#000000';\n\t\t\t\tcontext.fillRect(0, 0, width, height);\n\t\t\t\tcontext.globalAlpha = 1;\n\t\n\t\t\t\t// some artifacts and scratches\n\t\t\t\tdrawRandomArtifact(context, width, height);\n\t\t\t\tdrawRandomArtifact(context, width, height);\n\t\t\t\tdrawRandomArtifact(context, width, height);\n\t\t\t\tdrawRandomScratch(context, width, height);\n\t\t\t\tdrawRandomScratch(context, width, height);\n\t\t\t\tdrawRandomScratch(context, width, height);\n\t\t\t}\n\t\n\t\t\t// old grayscale filter, not too perfomant because of processing every image pixel.\n\t\t\t// just for history :)\n\t\n\t\t}, {\n\t\t\tkey: '_applyGrayscale',\n\t\t\tvalue: function _applyGrayscale(pixelData) {\n\t\t\t\tvar pixels = pixelData.data;\n\t\t\t\tvar pixelsLength = pixels.length;\n\t\t\t\tvar brightnessCoefficient = (0, _helpers.getRandom)(0.9, 1.1);\n\t\n\t\t\t\tfor (var i = 0; i < pixelsLength; i += 4) {\n\t\t\t\t\tvar r = pixels[i];\n\t\t\t\t\tvar g = pixels[i + 1];\n\t\t\t\t\tvar b = pixels[i + 2];\n\t\t\t\t\tvar a = pixels[i + 3];\n\t\t\t\t\tvar average = (0.21 * r + 0.72 * g + 0.07 * b) * brightnessCoefficient;\n\t\n\t\t\t\t\tpixels[i] = pixels[i + 1] = pixels[i + 2] = average;\n\t\t\t\t}\n\t\n\t\t\t\treturn pixelData;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_drawFrame',\n\t\t\tvalue: function _drawFrame() {\n\t\t\t\tvar _this3 = this;\n\t\n\t\t\t\tif (!this.state.isPlaying) return;\n\t\n\t\t\t\twindow.requestAnimationFrame(function () {\n\t\t\t\t\t_this3._updateTiming();\n\t\t\t\t\t_this3._updateCanvas();\n\t\t\t\t\t_this3._drawFrame();\n\t\t\t\t});\n\t\t\t}\n\t\n\t\t\t// Public methods\n\t\n\t\t}, {\n\t\t\tkey: 'play',\n\t\t\tvalue: function play() {\n\t\t\t\tvar elements = this.elements;\n\t\n\t\n\t\t\t\tthis.timing.lastFrameTimestamp = new Date();\n\t\t\t\tthis.state.isPlaying = true;\n\t\n\t\t\t\telements.playButton.classList.remove(classes.playButton.paused);\n\t\t\t\telements.playButton.classList.add(classes.playButton.playing);\n\t\n\t\t\t\tthis._playSoundtrack();\n\t\t\t\tthis._playVideo();\n\t\t\t\tthis._drawFrame();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'pause',\n\t\t\tvalue: function pause() {\n\t\t\t\tvar _this4 = this;\n\t\n\t\t\t\tvar elements = this.elements;\n\t\n\t\t\t\tthis.state.isPlaying = false;\n\t\n\t\t\t\twindow.requestAnimationFrame(function () {\n\t\t\t\t\telements.playButton.classList.remove(classes.playButton.playing);\n\t\t\t\t\telements.playButton.classList.add(classes.playButton.paused);\n\t\n\t\t\t\t\t_this4._pauseSoundtrack();\n\t\t\t\t\t_this4._pauseVideo();\n\t\t\t\t});\n\t\t\t}\n\t\t}]);\n\t\n\t\treturn Player;\n\t}();\n\t\n\texports.default = Player;\n\t\n\t\n\tfunction loadVideo(url) {\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tvar video = document.createElement('video');\n\t\t\tvideo.muted = true;\n\t\t\tvideo.addEventListener('error', reject);\n\t\t\tvideo.addEventListener('canplaythrough', function (event) {\n\t\t\t\tresolve(video);\n\t\t\t});\n\t\t\tvideo.src = url;\n\t\t});\n\t}\n\t\n\tfunction loadAudio(url) {\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tvar audio = document.createElement('audio');\n\t\t\taudio.addEventListener('error', reject);\n\t\t\taudio.addEventListener('canplaythrough', function (event) {\n\t\t\t\taudio.loop = true;\n\t\t\t\tresolve(audio);\n\t\t\t});\n\t\t\taudio.src = url;\n\t\t});\n\t}\n\t\n\tfunction loadTextFile(url) {\n\t\treturn fetch(url).then(function (response) {\n\t\t\treturn response.text();\n\t\t});\n\t}\n\t\n\tfunction parseSubtitles(source) {\n\t\treturn source.split('\\n\\n').map(function (slide) {\n\t\t\tvar data = slide.split('\\n');\n\t\t\tvar timing = data[1].split(' --> ');\n\t\t\tvar result = {\n\t\t\t\tid: null,\n\t\t\t\tstart: null,\n\t\t\t\tend: null,\n\t\t\t\tduration: null,\n\t\t\t\ttext: null\n\t\t\t};\n\t\n\t\t\tresult.id = parseInt(data[0], 10);\n\t\t\tresult.start = (0, _helpers.formattedTimeToSeconds)(timing[0]);\n\t\t\tresult.duration = (0, _helpers.formattedTimeToSeconds)(timing[1]) - result.start;\n\t\t\tresult.end = result.start + result.duration;\n\t\t\tresult.text = data.slice(2).join('\\n');\n\t\n\t\t\treturn result;\n\t\t});\n\t}\n\t\n\tfunction computeTimeline(parsedSubtitles, totalDuration) {\n\t\t// subtitles affects original timing,\n\t\t// so every time we show subtitles we just memorize their duration\n\t\t// and then consider it in further computations.\n\t\tvar passedSubtitlesTime = 0;\n\t\n\t\treturn parsedSubtitles.reduce(function (result, slide, index, array) {\n\t\t\tvar nextSlide = array[index + 1];\n\t\t\tvar prevSlide = array[index - 1] || {\n\t\t\t\tstart: 0,\n\t\t\t\tend: 0,\n\t\t\t\tduration: 0,\n\t\t\t\tisSynthethic: true\n\t\t\t};\n\t\n\t\t\tvar prevEnd = prevSlide.end + passedSubtitlesTime;\n\t\t\tvar currentStart = slide.start + passedSubtitlesTime;\n\t\t\tvar currentEnd = slide.end + passedSubtitlesTime;\n\t\t\tvar nextStart = nextSlide && nextSlide.start + passedSubtitlesTime;\n\t\n\t\t\tif (prevSlide.end < slide.start) {\n\t\t\t\tresult.push({\n\t\t\t\t\tstart: prevEnd,\n\t\t\t\t\tend: currentStart,\n\t\t\t\t\ttype: 'video'\n\t\t\t\t});\n\t\t\t}\n\t\n\t\t\tresult.push({\n\t\t\t\tstart: currentStart,\n\t\t\t\tend: currentEnd,\n\t\t\t\ttype: 'video'\n\t\t\t});\n\t\n\t\t\tresult.push({\n\t\t\t\tstart: currentEnd,\n\t\t\t\tend: currentEnd + slide.duration,\n\t\t\t\ttype: 'subtitles',\n\t\t\t\ttext: slide.text\n\t\t\t});\n\t\n\t\t\tpassedSubtitlesTime += slide.duration;\n\t\n\t\t\tif (!nextSlide) {\n\t\t\t\tresult.push({\n\t\t\t\t\tstart: slide.end + passedSubtitlesTime,\n\t\t\t\t\tend: totalDuration,\n\t\t\t\t\tduration: totalDuration - slide.end + passedSubtitlesTime,\n\t\t\t\t\ttype: 'video'\n\t\t\t\t});\n\t\t\t}\n\t\n\t\t\treturn result;\n\t\t}, []);\n\t}\n\t\n\tfunction drawRandomArtifact(context, width, height) {\n\t\tvar center = {\n\t\t\tx: (0, _helpers.getRandomInt)(0, width),\n\t\t\ty: (0, _helpers.getRandomInt)(0, height)\n\t\t};\n\t\n\t\tvar halfSize = 2.5;\n\t\n\t\tvar firstPoint = {\n\t\t\tx: (0, _helpers.getRandomInt)(center.x - halfSize, center.x + halfSize),\n\t\t\ty: (0, _helpers.getRandomInt)(center.y - halfSize, center.y + halfSize)\n\t\t};\n\t\n\t\tvar secondPoint = {\n\t\t\tx: (0, _helpers.getRandomInt)(center.x - halfSize, center.x + halfSize),\n\t\t\ty: (0, _helpers.getRandomInt)(center.y - halfSize, center.y + halfSize)\n\t\t};\n\t\n\t\tvar baseColor = (0, _helpers.getRandomInt)(0, 150);\n\t\tcontext.strokeStyle = 'rgb(' + baseColor + ', ' + baseColor + ', ' + baseColor + ')';\n\t\tcontext.lineWidth = 10;\n\t\tcontext.beginPath();\n\t\tcontext.moveTo(firstPoint.x, firstPoint.y);\n\t\tcontext.quadraticCurveTo(center.x, center.y, secondPoint.x, secondPoint.y);\n\t\tcontext.stroke();\n\t}\n\t\n\tfunction drawRandomScratch(context, width, height) {\n\t\tvar center = {\n\t\t\tx: (0, _helpers.getRandomInt)(0, width),\n\t\t\ty: (0, _helpers.getRandomInt)(0, height)\n\t\t};\n\t\n\t\tvar halfSize = (0, _helpers.getRandomInt)(5, 40);\n\t\n\t\tvar firstPoint = {\n\t\t\tx: (0, _helpers.getRandomInt)(center.x - halfSize, center.x + halfSize),\n\t\t\ty: (0, _helpers.getRandomInt)(center.y - halfSize, center.y + halfSize)\n\t\t};\n\t\n\t\tvar secondPoint = {\n\t\t\tx: (0, _helpers.getRandomInt)(center.x - halfSize, center.x + halfSize),\n\t\t\ty: (0, _helpers.getRandomInt)(center.y - halfSize, center.y + halfSize)\n\t\t};\n\t\n\t\tvar baseColor = (0, _helpers.getRandomInt)(0, 100);\n\t\tcontext.strokeStyle = 'rgb(' + baseColor + ', ' + baseColor + ', ' + baseColor + ')';\n\t\tcontext.lineWidth = 1;\n\t\tcontext.beginPath();\n\t\tcontext.moveTo(firstPoint.x, firstPoint.y);\n\t\tcontext.quadraticCurveTo(center.x, center.y, secondPoint.x, secondPoint.y);\n\t\tcontext.stroke();\n\t}\n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** bundle.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap dfda00a6aea96aee834a\n **/","import Application from './modules/application';\r\n\r\ndocument.addEventListener('DOMContentLoaded', onDOMContentLoaded);\r\n\r\nfunction onDOMContentLoaded() {\r\n\twindow.application = new Application();\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./source/js/index.js\n **/","export function formatSeconds(seconds) {\r\n\tlet minutesCount = Math.floor(seconds / 60);\r\n\r\n\treturn `${formatXXNumber(minutesCount)}:${formatXXNumber(Math.round(seconds % 60))}`;\r\n}\r\n\r\nfunction formatXXNumber(number) {\r\n\tlet result;\r\n\r\n\tif (number < 10 && number >= 1) {\r\n\t\tresult = `0${Math.round(number)}`;\r\n\t} else if (number < 1) {\r\n\t\tresult = '00';\r\n\t} else {\r\n\t\tresult = number.toString();\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function formattedTimeToSeconds(timeString) {\r\n\tconst data = timeString.split(':');\r\n\tconst hours = parseInt(data[0], 10);\r\n\tconst minutes = parseInt(data[1], 10);\r\n\tconst seconds = Math.round(parseFloat(data[2].replace(',', '.'), 10));\r\n\r\n\treturn seconds + (minutes * 60) + (hours * 60 * 60);\r\n}\r\n\r\nexport function getRandomInt(min, max) {\r\n\treturn Math.floor(Math.random() * (max - min + 1)) + min;\r\n}\r\n\r\nexport function getRandom(min, max) {\r\n    return Math.random() * (max - min) + min;\r\n}\r\n\r\nexport const webgl = {\r\n\tcreateShader(glContext, sourceCode, shaderType) {\r\n\t\tconst shader = glContext.createShader(shaderType);\r\n\t\tglContext.shaderSource(shader, sourceCode);\r\n\t\tglContext.compileShader(shader);\r\n\t\tconst compiledSuccessfully = glContext.getShaderParameter(shader, glContext.COMPILE_STATUS);\r\n\r\n\t\tif (!compiledSuccessfully) {\r\n\t\t\tthrow new Error('Could not compile shader: ', glContext.getShaderInfoLog(shader));\r\n\t\t}\r\n\r\n\t\treturn shader;\r\n\t},\r\n\r\n\tcreateProgram(glContext, vertexShader, fragmentShader) {\r\n\t\tconst program = glContext.createProgram();\r\n\r\n\t\tglContext.attachShader(program, vertexShader);\r\n\t\tglContext.attachShader(program, fragmentShader);\r\n\r\n\t\tglContext.linkProgram(program);\r\n\r\n\t\tconst linkedSuccessfully = glContext.getProgramParameter(program, glContext.LINK_STATUS);\r\n\r\n\t\tif (!linkedSuccessfully) {\r\n\t\t\tthrow new Error('Program failed to link: ', glContext.getProgramInfoLog(program));\r\n\t\t}\r\n\r\n\t\treturn program;\r\n\t},\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./source/js/helpers.js\n **/","import Player from './player';\r\n\r\nexport default class Application {\r\n\tconstructor(options = {}) {\r\n\t\tconst baseClass = options.baseClass || 'app';\r\n\t\tconst visiblePageClass = `${baseClass}__page_visible`;\r\n\r\n\t\tthis.root = document.querySelector(`.${baseClass}`);\r\n\t\tthis.form = this.root.querySelector(`.${baseClass}__form`);\r\n\t\tthis.pages = {\r\n\t\t\tstart: this.root.querySelector(`.${baseClass}__page_start`),\r\n\t\t\tmain: this.root.querySelector(`.${baseClass}__page_main`),\r\n\t\t};\r\n\r\n\t\tthis.links = {\r\n\t\t\tvideo: '',\r\n\t\t\tsubtitles: '',\r\n\t\t\tsoundtrack: '',\r\n\t\t}\r\n\r\n\t\tthis.form.addEventListener('submit', onFormSubmit.bind(this));\r\n\r\n\t\tfunction onFormSubmit(event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\t\r\n\t\t\tObject\r\n\t\t\t\t.keys(this.links)\r\n\t\t\t\t.forEach((type) => {\r\n\t\t\t\t\tthis.links[type] = this.form.querySelector(`[data-link-type=\"${type}\"]`).value;\r\n\t\t\t\t});\r\n\r\n\t\t\tthis.pages.start.classList.remove(visiblePageClass);\r\n\t\t\tthis.pages.main.classList.add(visiblePageClass);\r\n\r\n\t\t\twindow.player = this.player = new Player({\r\n\t\t\t\troot: this.root.querySelector('.player'),\r\n\t\t\t\tresources: this.links,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./source/js/modules/application.js\n **/","import {\r\n\tformatSeconds,\r\n\tformattedTimeToSeconds,\r\n\tgetRandomInt,\r\n\tgetRandom,\r\n\twebgl,\r\n} from '../helpers';\r\n\r\n\r\nconst baseClass = 'player';\r\nconst classes = {\r\n\tbase: baseClass,\r\n\tstage: {\r\n\t\tbase: `${baseClass}__stage`,\r\n\t},\r\n\tcanvas: {\r\n\t\tbase: `${baseClass}__canvas`,\r\n\t},\r\n\tplayButton: {\r\n\t\tbase: `${baseClass}__control_state`,\r\n\t\tpaused: `${baseClass}__control_state_play`,\r\n\t\tplaying: `${baseClass}__control_state_pause`,\r\n\t},\r\n\ttime: {\r\n\t\tbase: 'time',\r\n\t\twatched: 'time__watched',\r\n\t\ttotal: 'time__total',\r\n\t},\r\n\tfakeVideo: {\r\n\t\tbase: `${baseClass}__fakeVideo`,\r\n\t},\r\n\tprogress: {\r\n\t\tbase: 'progress',\r\n\t\tbar: 'progress__bar',\r\n\t},\r\n};\r\n\r\nexport default class Player {\r\n\t/**\r\n\t * @param {Object} root - root DOM node for player\r\n\t * @param {Object} resources - list of resources urls to use (video, soundtrack, subtitles)\r\n\t */\r\n\tconstructor({root, resources}) {\r\n\t\tthis.elements = {\r\n\t\t\troot,\r\n\t\t\tstage: root.querySelector(`.${classes.stage.base}`),\r\n\t\t\tcanvas: root.querySelector(`.${classes.canvas.base}`),\r\n\t\t\tplayButton: root.querySelector(`.${classes.playButton.base}`),\r\n\t\t\ttimeWatched: root.querySelector(`.${classes.time.watched}`),\r\n\t\t\ttimeTotal: root.querySelector(`.${classes.time.total}`),\r\n\t\t\tprogressBar: root.querySelector(`.${classes.progress.bar}`),\r\n\t\t};\r\n\r\n\t\tthis.state = {\r\n\t\t\tisPlaying: false,\r\n\t\t\tvideoIsPlaying: false,\r\n\t\t\taudioIsPlaying: false,\r\n\t\t};\r\n\r\n\t\tPromise\r\n\t\t\t.all([\r\n\t\t\t\tloadVideo(resources.video),\r\n\t\t\t\tloadAudio(resources.soundtrack),\r\n\t\t\t\tloadTextFile(resources.subtitles),\r\n\t\t\t])\r\n\t\t\t.then((result) => {\r\n\t\t\t\tthis.video = result[0];\r\n\t\t\t\tthis.audio = result[1];\r\n\t\t\t\tthis.subtitles = parseSubtitles(result[2]);\r\n\r\n\t\t\t\tthis._addEventListeners();\r\n\t\t\t\tthis._setupCanvas();\r\n\t\t\t\tthis._setupTiming();\r\n\t\t\t\tthis._setupSound();\r\n\r\n\t\t\t\tthis.elements.root.classList.add(`${classes.base}_initialized`);\r\n\t\t\t\tthis.play();\r\n\t\t\t});\r\n\t}\r\n\r\n\t_addEventListeners() {\r\n\t\tconst {elements} = this;\r\n\t\tconst playControls = [elements.playButton, elements.stage];\r\n\r\n\t\tplayControls.map((control) => control.addEventListener('click', () => {\r\n\t\t\tthis[this.state.isPlaying ? 'pause' : 'play']();\r\n\t\t}));\r\n\t}\r\n\r\n\t/**\r\n\t * Creates all contexts and sets sizes\r\n\t */\r\n\t_setupCanvas() {\r\n\t\tconst {video, elements} = this;\r\n\r\n\t\tconst virtualCanvas = elements.virtualCanvas = document.createElement('canvas');\r\n\r\n\t\tthis.context = elements.canvas.getContext('2d');\r\n\t\tthis.virtualContext = virtualCanvas.getContext('2d');\r\n\r\n\t\telements.canvas.width = virtualCanvas.width = video.videoWidth;\r\n\t\telements.canvas.height = virtualCanvas.height = video.videoHeight;\r\n\t}\r\n\r\n\t_setupTiming() {\r\n\t\tconst subtitlesDuration = this.subtitles.reduce((result, slideData) => result + slideData.duration, 0);\r\n\t\tconst videoDuration = Math.round(this.video.duration);\r\n\t\tconst duration = videoDuration + subtitlesDuration;\r\n\r\n\t\tthis.timing = {\r\n\t\t\tduration,\r\n\t\t\twatchedSeconds: 0,\r\n\t\t\tprevWatchedSecond: 0,\r\n\t\t\tlastFrameTimestamp: null,\r\n\t\t};\r\n\r\n\t\tthis.timeline = computeTimeline(this.subtitles, duration);\r\n\t\tthis.elements.timeTotal.innerText = formatSeconds(this.timing.duration);\r\n\t}\r\n\r\n\t_setupSound() {\r\n\t\tconst audioContext = this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\r\n\t\tconst audioSource = this.audioSource = audioContext.createMediaElementSource(this.audio);\r\n\t\tconst brownNoise = (function() {\r\n\t\t\tconst bufferSize = 4096;\r\n\t\t\tlet lastOut = 0.0;\r\n\t\t\tconst node = audioContext.createScriptProcessor(bufferSize, 1, 1);\r\n\t\t\tnode.onaudioprocess = function(e) {\r\n\t\t\t\tconst output = e.outputBuffer.getChannelData(0);\r\n\t\t\t\tfor (let i = 0; i < bufferSize; i++) {\r\n\t\t\t\t\tconst white = Math.random() * 2 - 1;\r\n\t\t\t\t\toutput[i] = (lastOut + (0.02 * white)) / 1.02;\r\n\t\t\t\t\tlastOut = output[i];\r\n\t\t\t\t\toutput[i] *= 0.25; // (roughly) compensate for gain\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn node;\r\n\t\t})();\r\n\r\n\t\tbrownNoise.connect(audioContext.destination);\r\n\r\n\t\tconst biquadFilter = audioContext.createBiquadFilter();\r\n\t\tbiquadFilter.type = 'highpass';\r\n\t\tbiquadFilter.frequency.value = 900;\r\n\t\tbiquadFilter.gain.value = 5;\r\n\r\n\t\taudioSource.connect(biquadFilter);\r\n\t\tbiquadFilter.connect(audioContext.destination);\r\n\t}\r\n\r\n\t_playSoundtrack() {\r\n\t\tif (!this.state.audioIsPlaying) {\r\n\t\t\tthis.audio.play();\r\n\t\t\tthis.audioContext.resume();\r\n\t\t\tthis.state.audioIsPlaying = true;\r\n\t\t}\r\n\t}\r\n\r\n\t_playVideo() {\r\n\t\tif (!this.state.videoIsPlaying) {\r\n\t\t\tthis.state.videoIsPlaying = true;\r\n\t\t\tthis.video.play();\r\n\t\t}\r\n\t}\r\n\r\n\t_pauseSoundtrack() {\r\n\t\tif (this.state.audioIsPlaying) {\r\n\t\t\tthis.audio.pause();\r\n\t\t\tthis.audioContext.suspend();\r\n\t\t\tthis.state.audioIsPlaying = false;\r\n\t\t}\r\n\t}\r\n\r\n\t_pauseVideo() {\r\n\t\tif (this.state.videoIsPlaying) {\r\n\t\t\tthis.state.videoIsPlaying = false;\r\n\t\t\tthis.video.pause();\r\n\t\t}\r\n\t}\r\n\t\r\n\t_updateTiming() {\r\n\t\tconst {timing} = this;\r\n\t\tconst currentFrameTimestamp = new Date();\r\n\r\n\t\tif (!timing.lastFrameTimestamp) {\r\n\t\t\ttiming.lastFrameTimestamp = currentFrameTimestamp;\r\n\t\t}\r\n\r\n\t\ttiming.prevWatchedSeconds = timing.watchedSeconds;\r\n\t\ttiming.watchedSeconds += (currentFrameTimestamp - timing.lastFrameTimestamp) / 1000;\r\n\t\ttiming.lastFrameTimestamp = currentFrameTimestamp;\r\n\r\n\t\tthis._updateWatchedTime();\r\n\t}\r\n\r\n\t_updateWatchedTime(seconds) {\r\n\t\tconst {watchedSeconds, prevWatchedSeconds, duration} = this.timing;\r\n\t\tif (Math.floor(prevWatchedSeconds) === Math.floor(watchedSeconds)) return;\r\n\t\tthis.elements.progressBar.style.transform = `translate(${-100 + (watchedSeconds / duration * 100)}%, 0)`;\r\n\t\tthis.elements.timeWatched.innerText = formatSeconds(watchedSeconds);\r\n\t}\r\n\r\n\t_updateCanvas() {\r\n\t\tconst {elements, virtualContext, timing} = this;\r\n\t\tconst {width, height} = elements.canvas;\r\n\r\n\t\tconst findFrameData = (time) => ({start, end}) => start <= time && end > time;\r\n\t\tconst currentFrameData = this.timeline.find(findFrameData(timing.watchedSeconds));\r\n\r\n\t\tvirtualContext.clearRect(0, 0, width, height);\r\n\r\n\t\tif (currentFrameData.type === 'video') {\r\n\t\t\tthis._playVideo();\r\n\t\t\tthis.textWasDrawn = false;\r\n\t\t\tvirtualContext.drawImage(this.video, 0, 0, width, height);\r\n\t\t}\r\n\r\n\t\tif (currentFrameData.type === 'subtitles') {\r\n\t\t\tthis._pauseVideo();\r\n\t\t\tthis._drawSubtitles(currentFrameData.text);\r\n\t\t}\r\n\r\n\t\tthis._applyEffects();\r\n\t}\r\n\r\n\t_drawSubtitles(text) {\r\n\t\tconst {virtualContext, elements} = this;\r\n\t\tconst {width, height} = elements.canvas;\r\n\r\n\t\tvirtualContext.fillStyle = '#000000';\r\n\t\tvirtualContext.font = '22px Oranienbaum';\r\n\t\tvirtualContext.fillRect(0, 0, width, height);\r\n\t\tvirtualContext.fillStyle = '#ffffff';\r\n\r\n\t\tconst rows = text.split('\\n');\r\n\t\tconst mostWideRow = rows.reduce((string, currentRow) => {\r\n\t\t\treturn currentRow.length > string.length ? currentRow : string;\r\n\t\t}, '');\r\n\t\tconst lineHeight = 28;\r\n\r\n\t\tconst positionY = height / 2 - (rows.length * lineHeight) / 2;\r\n\t\tconst positionX = width / 2 - virtualContext.measureText(mostWideRow).width / 2;\r\n\r\n\t\trows.map((row, i) => {\r\n\t\t\tvirtualContext.fillText(row, positionX, positionY + i * lineHeight);\r\n\t\t});\r\n\t}\r\n\r\n\t_applyEffects() {\r\n\t\tconst {context, elements} = this;\r\n\t\tconst {width, height} = elements.virtualCanvas;\r\n\r\n\t\t// current frame\r\n\t\tcontext.drawImage(elements.virtualCanvas, 0, 0, width, height);\r\n\r\n\t\tcontext.globalCompositeOperation = 'color';\r\n\r\n\t\t// overlay for grayscale filter\r\n\t\tcontext.fillStyle = '#ffffff';\r\n\t\tcontext.fillRect(0, 0, width, height);\r\n\r\n\t\tcontext.globalCompositeOperation = 'source-over';\r\n\r\n\t\t// overlay for blinking\r\n\t\tcontext.globalAlpha = getRandom(0, 0.2);\r\n\t\tcontext.fillStyle = '#000000';\r\n\t\tcontext.fillRect(0, 0, width, height);\r\n\t\tcontext.globalAlpha = 1;\r\n\r\n\t\t// some artifacts and scratches\r\n\t\tdrawRandomArtifact(context, width, height);\r\n\t\tdrawRandomArtifact(context, width, height);\r\n\t\tdrawRandomArtifact(context, width, height);\r\n\t\tdrawRandomScratch(context, width, height);\r\n\t\tdrawRandomScratch(context, width, height);\r\n\t\tdrawRandomScratch(context, width, height);\r\n\t}\r\n\r\n\t// old grayscale filter, not too perfomant because of processing every image pixel.\r\n\t// just for history :)\r\n\t_applyGrayscale(pixelData) {\r\n\t\tconst pixels = pixelData.data;\r\n\t\tconst pixelsLength = pixels.length;\r\n\t\tconst brightnessCoefficient = getRandom(0.9, 1.1);\r\n\r\n\t\tfor (let i = 0; i < pixelsLength; i += 4) {\r\n\t\t\tconst r = pixels[i];\r\n\t\t\tconst g = pixels[i + 1];\r\n\t\t\tconst b = pixels[i + 2];\r\n\t\t\tconst a = pixels[i + 3];\r\n\t\t\tconst average = (0.21 * r + 0.72 * g + 0.07 * b) * brightnessCoefficient;\r\n\r\n\t\t\tpixels[i] = pixels[i + 1] = pixels[i + 2] = average;\r\n\t\t}\r\n\r\n\t\treturn pixelData;\r\n\t}\r\n\r\n\t_drawFrame() {\r\n\t\tif (!this.state.isPlaying) return;\r\n\r\n\t\twindow.requestAnimationFrame(() => {\r\n\t\t\tthis._updateTiming();\r\n\t\t\tthis._updateCanvas();\r\n\t\t\tthis._drawFrame();\r\n\t\t});\r\n\t}\r\n\r\n\t// Public methods\r\n\r\n\tplay() {\r\n\t\tconst {elements} = this;\r\n\r\n\t\tthis.timing.lastFrameTimestamp = new Date();\r\n\t\tthis.state.isPlaying = true;\r\n\r\n\t\telements.playButton.classList.remove(classes.playButton.paused);\r\n\t\telements.playButton.classList.add(classes.playButton.playing);\r\n\r\n\t\tthis._playSoundtrack();\r\n\t\tthis._playVideo();\r\n\t\tthis._drawFrame();\r\n\t}\r\n\r\n\tpause() {\r\n\t\tconst {elements} = this;\r\n\t\tthis.state.isPlaying = false;\r\n\r\n\t\twindow.requestAnimationFrame(() => {\r\n\t\t\telements.playButton.classList.remove(classes.playButton.playing);\r\n\t\t\telements.playButton.classList.add(classes.playButton.paused);\r\n\r\n\t\t\tthis._pauseSoundtrack();\r\n\t\t\tthis._pauseVideo();\r\n\t\t});\r\n\t}\r\n}\r\n\r\n\r\nfunction loadVideo(url) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tconst video = document.createElement('video');\r\n\t\tvideo.muted = true;\r\n\t\tvideo.addEventListener('error', reject);\r\n\t\tvideo.addEventListener('canplaythrough', (event) => {\r\n\t\t\tresolve(video);\r\n\t\t});\r\n\t\tvideo.src = url;\r\n\t});\r\n}\r\n\r\nfunction loadAudio(url) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tconst audio = document.createElement('audio');\r\n\t\taudio.addEventListener('error', reject);\r\n\t\taudio.addEventListener('canplaythrough', (event) => {\r\n\t\t\taudio.loop = true;\r\n\t\t\tresolve(audio);\r\n\t\t});\r\n\t\taudio.src = url;\r\n\t});\r\n}\r\n\r\nfunction loadTextFile(url) {\r\n\treturn fetch(url).then((response) => response.text());\r\n}\r\n\r\nfunction parseSubtitles(source) {\r\n\treturn source\r\n\t\t.split('\\n\\n')\r\n\t\t.map((slide) => {\r\n\t\t\tconst data = slide.split('\\n');\r\n\t\t\tconst timing = data[1].split(' --> ');\r\n\t\t\tconst result = {\r\n\t\t\t\tid: null,\r\n\t\t\t\tstart: null,\r\n\t\t\t\tend: null,\r\n\t\t\t\tduration: null,\r\n\t\t\t\ttext: null,\r\n\t\t\t};\r\n\r\n\t\t\tresult.id = parseInt(data[0], 10);\r\n\t\t\tresult.start = formattedTimeToSeconds(timing[0]);\r\n\t\t\tresult.duration = formattedTimeToSeconds(timing[1]) - result.start;\r\n\t\t\tresult.end = result.start + result.duration;\r\n\t\t\tresult.text = data.slice(2).join('\\n');\r\n\t\t\t\r\n\t\t\treturn result;\r\n\t\t});\r\n}\r\n\r\nfunction computeTimeline(parsedSubtitles, totalDuration) {\r\n\t// subtitles affects original timing,\r\n\t// so every time we show subtitles we just memorize their duration\r\n\t// and then consider it in further computations.\r\n\tlet passedSubtitlesTime = 0;\r\n\r\n\treturn parsedSubtitles.reduce((result, slide, index, array) => {\r\n\t\tconst nextSlide = array[index + 1];\r\n\t\tconst prevSlide = (array[index - 1] || {\r\n\t\t\tstart: 0,\r\n\t\t\tend: 0,\r\n\t\t\tduration: 0,\r\n\t\t\tisSynthethic: true,\r\n\t\t});\r\n\r\n\t\tconst prevEnd = prevSlide.end + passedSubtitlesTime;\r\n\t\tconst currentStart = slide.start + passedSubtitlesTime;\r\n\t\tconst currentEnd = slide.end + passedSubtitlesTime;\r\n\t\tconst nextStart = nextSlide && nextSlide.start + passedSubtitlesTime;\r\n\r\n\t\tif (prevSlide.end < slide.start) {\r\n\t\t\tresult.push({\r\n\t\t\t\tstart: prevEnd,\r\n\t\t\t\tend: currentStart,\r\n\t\t\t\ttype: 'video',\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tresult.push({\r\n\t\t\tstart: currentStart,\r\n\t\t\tend: currentEnd,\r\n\t\t\ttype: 'video',\r\n\t\t});\r\n\r\n\t\tresult.push({\r\n\t\t\tstart: currentEnd,\r\n\t\t\tend: currentEnd + slide.duration,\r\n\t\t\ttype: 'subtitles',\r\n\t\t\ttext: slide.text,\r\n\t\t});\r\n\r\n\t\tpassedSubtitlesTime += slide.duration;\r\n\r\n\t\tif (!nextSlide) {\r\n\t\t\tresult.push({\r\n\t\t\t\tstart: slide.end + passedSubtitlesTime,\r\n\t\t\t\tend: totalDuration,\r\n\t\t\t\tduration: totalDuration - slide.end + passedSubtitlesTime,\r\n\t\t\t\ttype: 'video',\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}, []);\r\n}\r\n\r\nfunction drawRandomArtifact(context, width, height) {\r\n\tconst center = {\r\n\t\tx: getRandomInt(0, width),\r\n\t\ty: getRandomInt(0, height),\r\n\t};\r\n\r\n\tconst halfSize = 2.5;\r\n\r\n\tconst firstPoint = {\r\n\t\tx: getRandomInt(center.x - halfSize, center.x + halfSize),\r\n\t\ty: getRandomInt(center.y - halfSize, center.y + halfSize),\r\n\t};\r\n\r\n\tconst secondPoint = {\r\n\t\tx: getRandomInt(center.x - halfSize, center.x + halfSize),\r\n\t\ty: getRandomInt(center.y - halfSize, center.y + halfSize),\r\n\t};\r\n\r\n\tconst baseColor = getRandomInt(0, 150);\r\n\tcontext.strokeStyle = `rgb(${baseColor}, ${baseColor}, ${baseColor})`;\r\n\tcontext.lineWidth = 10;\r\n\tcontext.beginPath();\r\n\t\tcontext.moveTo(firstPoint.x, firstPoint.y);\r\n\t\tcontext.quadraticCurveTo(\r\n\t\t\tcenter.x,\r\n\t\t\tcenter.y,\r\n\t\t\tsecondPoint.x,\r\n\t\t\tsecondPoint.y\r\n\t\t);\r\n\tcontext.stroke();\r\n}\r\n\r\nfunction drawRandomScratch(context, width, height) {\r\n\tconst center = {\r\n\t\tx: getRandomInt(0, width),\r\n\t\ty: getRandomInt(0, height),\r\n\t};\r\n\r\n\tconst halfSize = getRandomInt(5, 40);\r\n\r\n\tconst firstPoint = {\r\n\t\tx: getRandomInt(center.x - halfSize, center.x + halfSize),\r\n\t\ty: getRandomInt(center.y - halfSize, center.y + halfSize),\r\n\t};\r\n\r\n\tconst secondPoint = {\r\n\t\tx: getRandomInt(center.x - halfSize, center.x + halfSize),\r\n\t\ty: getRandomInt(center.y - halfSize, center.y + halfSize),\r\n\t};\r\n\r\n\tconst baseColor = getRandomInt(0, 100);\r\n\tcontext.strokeStyle = `rgb(${baseColor}, ${baseColor}, ${baseColor})`;\r\n\tcontext.lineWidth = 1;\r\n\tcontext.beginPath();\r\n\t\tcontext.moveTo(firstPoint.x, firstPoint.y);\r\n\t\tcontext.quadraticCurveTo(\r\n\t\t\tcenter.x,\r\n\t\t\tcenter.y,\r\n\t\t\tsecondPoint.x,\r\n\t\t\tsecondPoint.y\r\n\t\t);\r\n\tcontext.stroke();\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./source/js/modules/player.js\n **/"],"sourceRoot":""}